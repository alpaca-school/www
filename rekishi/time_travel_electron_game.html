<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚ç©ºæ¢åµã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ³ï¼šå‰äººãŸã¡ã¨å…‰ã®åœ°å›³</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Hiragino Sans', 'Yu Gothic', sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            overflow: hidden;
            height: 100vh;
        }

        .container {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        /* ã‚²ãƒ¼ãƒ HUD */
        .game-hud {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px;
            border-radius: 15px;
            min-width: 250px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .hud-item {
            margin: 10px 0;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .score {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.5em;
        }

        .timer {
            color: #ff6b6b;
            font-weight: bold;
        }

        .lives {
            font-size: 1.5em;
        }

        .combo {
            color: #4caf50;
            font-weight: bold;
        }

        /* å®Ÿç¸¾ãƒãƒƒã‚¸ */
        .achievements {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px;
            border-radius: 15px;
            max-width: 200px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .badge {
            display: inline-block;
            margin: 5px;
            font-size: 2em;
            filter: grayscale(100%);
            opacity: 0.3;
            transition: all 0.3s;
        }

        .badge.unlocked {
            filter: grayscale(0%);
            opacity: 1;
            animation: badgeUnlock 0.5s ease;
        }

        @keyframes badgeUnlock {
            0% { transform: scale(0); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }

        /* é›£æ˜“åº¦é¸æŠ */
        .difficulty-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
        }

        .difficulty-modal.show {
            display: block;
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        .difficulty-button {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 10px 0;
            font-size: 1.3em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .difficulty-easy {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
        }

        .difficulty-normal {
            background: linear-gradient(135deg, #2196f3, #03a9f4);
            color: white;
        }

        .difficulty-hard {
            background: linear-gradient(135deg, #f44336, #ff5722);
            color: white;
        }

        .difficulty-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .slide.active {
            display: flex;
            opacity: 1;
        }

        .slide-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 900px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            position: relative;
        }

        h1 {
            color: #1e3c72;
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #2a5298;
            font-size: 2em;
            margin-bottom: 15px;
        }

        .chapter-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            display: inline-block;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .inventor-name {
            color: #764ba2;
            font-size: 1.5em;
            margin: 15px 0;
            font-weight: bold;
        }

        .story {
            font-size: 1.2em;
            line-height: 1.8;
            margin: 20px 0;
            color: #333;
        }

        .mission-box {
            background: #fff3cd;
            border: 3px dashed #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .mission-title {
            color: #e65100;
            font-weight: bold;
            font-size: 1.3em;
            margin-bottom: 15px;
        }

        .challenge-timer {
            font-size: 1.5em;
            color: #f44336;
            font-weight: bold;
            margin: 10px 0;
        }

        /* ãƒœãƒ«ã‚¿ã®é›»æ± å®Ÿé¨“ - ãƒ¡ãƒ¢ãƒªãƒ¼ã‚²ãƒ¼ãƒ é¢¨ */
        .volta-battery {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .battery-cell {
            width: 80px;
            height: 100px;
            background: linear-gradient(to bottom, #c0c0c0 0%, #c0c0c0 45%, #b87333 55%, #b87333 100%);
            border: 3px solid #333;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
        }

        .battery-cell:hover {
            transform: scale(1.1);
        }

        .battery-cell.active {
            background: linear-gradient(to bottom, #ffd700 0%, #ffd700 45%, #ff6b6b 55%, #ff6b6b 100%);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .battery-cell.wrong {
            background: #666;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .power-meter {
            width: 300px;
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            margin: 20px auto;
            overflow: hidden;
            border: 3px solid #333;
            position: relative;
        }

        .power-level {
            height: 100%;
            width: 0%;
            background: linear-gradient(to right, #4caf50, #8bc34a, #ffd700);
            transition: width 0.3s ease;
            position: relative;
        }

        .power-level::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼ã®é›»ç£èª˜å° - ãƒªã‚ºãƒ ã‚²ãƒ¼ãƒ é¢¨ */
        .faraday-coil {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 20px auto;
        }

        .coil-image {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ffd700 0%, #ff6b6b 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            color: white;
            transition: all 0.2s;
        }

        .coil-image.energized {
            animation: pulse 0.5s ease;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .magnet-slider {
            width: 80%;
            margin: 20px auto;
            height: 20px;
            -webkit-appearance: none;
            background: linear-gradient(to right, #2196f3, #f44336);
            border-radius: 10px;
            outline: none;
        }

        .magnet-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 40px;
            height: 40px;
            background: #ffd700;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .speed-meter {
            font-size: 1.3em;
            margin: 15px 0;
            color: #2196f3;
            font-weight: bold;
        }

        .led-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #666;
            margin: 20px auto;
            transition: all 0.1s;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .led-indicator.on {
            background: radial-gradient(circle, #ff0000, #ff6b6b);
            box-shadow: 0 0 30px #ff0000, inset 0 0 10px rgba(255, 255, 255, 0.5);
        }

        /* ã‚¨ã‚¸ã‚½ãƒ³ã®é…ç·šãƒ‘ã‚ºãƒ« - ãƒ‘ã‚ºãƒ«ã‚²ãƒ¼ãƒ  */
        .edison-city {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 20px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .street-light {
            width: 100px;
            height: 140px;
            background: #333;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid #666;
        }

        .street-light::before {
            content: 'ğŸ’¡';
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
            filter: grayscale(100%);
            transition: all 0.3s;
        }

        .street-light::after {
            content: attr(data-number);
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5em;
            color: white;
            font-weight: bold;
        }

        .street-light.powered::before {
            filter: grayscale(0%);
            animation: glow 1s ease infinite;
        }

        .street-light.powered {
            border-color: #ffd700;
            background: #1a1a1a;
        }

        @keyframes glow {
            0%, 100% { 
                text-shadow: 0 0 10px yellow;
                transform: translateX(-50%) scale(1);
            }
            50% { 
                text-shadow: 0 0 30px yellow, 0 0 40px orange;
                transform: translateX(-50%) scale(1.1);
            }
        }

        .wire-display {
            font-size: 1.2em;
            margin: 15px 0;
            min-height: 30px;
        }

        /* ãƒ†ã‚¹ãƒ©ã®åˆ¶å¾¡ãƒ‘ãƒãƒ« - ã‚µã‚¤ãƒ¢ãƒ³ã‚²ãƒ¼ãƒ é¢¨ */
        .tesla-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .control-button {
            width: 110px;
            height: 110px;
            border-radius: 15px;
            border: 4px solid #333;
            font-size: 2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            position: relative;
        }

        .control-button:hover {
            transform: scale(1.05);
        }

        .control-button.flash {
            background: #ffd700;
            box-shadow: 0 0 30px #ffd700;
            transform: scale(1.15);
        }

        .control-button.activated {
            background: #4caf50;
            box-shadow: 0 0 20px #4caf50;
        }

        .control-button.error {
            background: #f44336;
            animation: shake 0.3s;
        }

        .sequence-display {
            font-size: 1.5em;
            margin: 20px 0;
            min-height: 50px;
            font-weight: bold;
        }

        .pattern-level {
            color: #764ba2;
            font-size: 1.2em;
            margin: 10px 0;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .navigation {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            z-index: 1000;
        }

        .nav-button {
            padding: 15px 40px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: white;
            color: #1e3c72;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(255, 255, 255, 0.3);
            z-index: 999;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, #4caf50, #ffd700);
            width: 0%;
            transition: width 0.5s ease;
        }

        .quote-box {
            background: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
            font-style: italic;
            color: #2e7d32;
        }

        .success-message {
            background: linear-gradient(135deg, #4caf50, #8bc34a);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.3em;
            display: none;
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .success-message.show {
            display: block;
            animation: successAppear 0.5s ease;
        }

        @keyframes successAppear {
            from { opacity: 0; transform: translateY(-20px) scale(0.8); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .particle {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #ffd700;
            border-radius: 50%;
            pointer-events: none;
            animation: particleFly 1s ease-out forwards;
        }

        @keyframes particleFly {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        .final-score {
            font-size: 3em;
            color: #ffd700;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .rank-display {
            font-size: 2em;
            margin: 20px 0;
        }

        .rank-s { color: #ffd700; }
        .rank-a { color: #c0c0c0; }
        .rank-b { color: #cd7f32; }
        .rank-c { color: #666; }

        .retry-button {
            padding: 20px 50px;
            font-size: 1.5em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
            margin: 20px;
        }

        .retry-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <!-- ã‚²ãƒ¼ãƒ HUD -->
    <div class="game-hud">
        <div class="hud-item">
            <span>ã‚¹ã‚³ã‚¢:</span>
            <span class="score" id="score">0</span>
        </div>
        <div class="hud-item">
            <span>ã‚¿ã‚¤ãƒãƒ¼:</span>
            <span class="timer" id="timer">--</span>
        </div>
        <div class="hud-item">
            <span>ãƒ©ã‚¤ãƒ•:</span>
            <span class="lives" id="lives">â¤ï¸â¤ï¸â¤ï¸</span>
        </div>
        <div class="hud-item">
            <span>ã‚³ãƒ³ãƒœ:</span>
            <span class="combo" id="combo">Ã—1</span>
        </div>
    </div>

    <!-- å®Ÿç¸¾ãƒãƒƒã‚¸ -->
    <div class="achievements">
        <div class="achievement-title">â­ å®Ÿç¸¾</div>
        <div class="badge" id="badge1" title="å®Œç’§ãªé›»æ± ">ğŸ”‹</div>
        <div class="badge" id="badge2" title="è¶…é«˜é€Ÿèª˜å°">âš¡</div>
        <div class="badge" id="badge3" title="é…ç·šãƒã‚¹ã‚¿ãƒ¼">ğŸ’¡</div>
        <div class="badge" id="badge4" title="åˆ¶å¾¡ã®å¤©æ‰">ğŸ®</div>
        <div class="badge" id="badge5" title="æ™‚ç©ºåˆ¶è¦‡">ğŸ‘‘</div>
    </div>

    <!-- é›£æ˜“åº¦é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="difficulty-modal show" id="difficultyModal">
        <h2 style="margin-bottom: 30px; color: #1e3c72;">é›£æ˜“åº¦ã‚’é¸æŠã—ã¦ãã ã•ã„</h2>
        <button class="difficulty-button difficulty-easy" onclick="startGame('easy')">
            ğŸŒ± ã‚¤ãƒ¼ã‚¸ãƒ¼<br>
            <small>ã‚†ã£ãã‚Šå­¦ç¿’ / æ™‚é–“åˆ¶é™ãªã—</small>
        </button>
        <button class="difficulty-button difficulty-normal" onclick="startGame('normal')">
            âš¡ ãƒãƒ¼ãƒãƒ«<br>
            <small>æ¨™æº–çš„ãªæŒ‘æˆ¦ / é©åº¦ãªæ™‚é–“åˆ¶é™</small>
        </button>
        <button class="difficulty-button difficulty-hard" onclick="startGame('hard')">
            ğŸ”¥ ãƒãƒ¼ãƒ‰<br>
            <small>æœ¬æ°—ãƒ¢ãƒ¼ãƒ‰ / å³ã—ã„æ™‚é–“åˆ¶é™</small>
        </button>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>

    <div class="container">
        <!-- ãƒ—ãƒ­ãƒ­ãƒ¼ã‚° -->
        <div class="slide" id="slide0">
            <div class="slide-content">
                <h1>âš¡ æ™‚ç©ºæ¢åµã‚¨ãƒ¬ã‚¯ãƒˆãƒ­ãƒ³ âš¡</h1>
                <h2>å‰äººãŸã¡ã¨å…‰ã®åœ°å›³</h2>
                <div class="story">
                    <p style="font-size: 1.5em; margin: 30px 0;">
                        ç¾ä»£ã®è¡—ã‹ã‚‰å…‰ãŒæ¶ˆãˆã¦ã—ã¾ã£ãŸï¼<br><br>
                        åŸå› ã¯ã€éå»ã®å¤©æ‰ãŸã¡ãŒç ”ç©¶ã«è¡Œãè©°ã¾ã‚Šã€<br>
                        æ­´å²ãŒå¤‰ã‚ã£ã¦ã—ã¾ã£ãŸã‹ã‚‰ã€‚<br><br>
                        ã‚ãªãŸã¯ã€Œæ™‚ç©ºã®ä½œæ¥­ã‚«ãƒãƒ³ã€ã‚’æ‰‹ã«ã€<br>
                        18ä¸–ç´€ã‹ã‚‰ç¾ä»£ã¸æ—…ç«‹ã¡ã¾ã™ã€‚
                    </p>
                    <div style="font-size: 5em; margin: 20px 0;">ğŸ”¦ğŸ’¼âš¡</div>
                    <p style="color: #e65100; font-size: 1.3em; margin-top: 30px;">
                        â±ï¸ å„ç« ã«ã¯æ™‚é–“åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼<br>
                        ğŸ’¯ é«˜å¾—ç‚¹ã‚’ç›®æŒ‡ã—ã¦å®Ÿç¸¾ã‚’ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ã—ã‚ˆã†ï¼
                    </p>
                </div>
            </div>
        </div>

        <!-- ç¬¬1ç« ï¼šãƒœãƒ«ã‚¿ -->
        <div class="slide" id="slide1">
            <div class="slide-content">
                <div class="chapter-title">ç¬¬1ç« ï¼šãƒœãƒ«ã‚¿ã®ã€Œã—ã³ã‚Œã‚‹ã€æŸ±</div>
                <div class="inventor-name">ğŸ‡®ğŸ‡¹ ã‚¢ãƒ¬ãƒƒã‚µãƒ³ãƒ‰ãƒ­ãƒ»ãƒœãƒ«ã‚¿</div>
                <div class="story">
                    ã€Œä¸–ç•Œæœ€åˆã®é›»æ± ã‚’ä½œã‚ŠãŸã„ã‚“ã ï¼<br>
                    æ­£ã—ã„é †ç•ªã§é›»æ± ã‚»ãƒ«ã‚’èµ·å‹•ã•ã›ã¦ãã‚Œï¼ã€
                </div>
                <div class="mission-box">
                    <div class="mission-title">ğŸ¯ ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼šãƒ¡ãƒ¢ãƒªãƒ¼ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
                    å…‰ã‚‹ã‚»ãƒ«ã®é †ç•ªã‚’è¦šãˆã¦ã€åŒã˜é †ç•ªã§ã‚¯ãƒªãƒƒã‚¯ï¼<br>
                    âš ï¸ é–“é•ãˆã‚‹ã¨ãƒ©ã‚¤ãƒ•ãŒæ¸›ã‚Šã¾ã™
                    <div class="challenge-timer" id="voltaTimer">æ®‹ã‚Šæ™‚é–“: --</div>
                </div>
                <div class="volta-battery" id="voltaBattery">
                    <div class="battery-cell" data-cell="0"></div>
                    <div class="battery-cell" data-cell="1"></div>
                    <div class="battery-cell" data-cell="2"></div>
                    <div class="battery-cell" data-cell="3"></div>
                    <div class="battery-cell" data-cell="4"></div>
                    <div class="battery-cell" data-cell="5"></div>
                    <div class="battery-cell" data-cell="6"></div>
                    <div class="battery-cell" data-cell="7"></div>
                </div>
                <div class="power-meter">
                    <div class="power-level" id="powerLevel"></div>
                </div>
                <div id="voltaMessage" style="min-height: 30px; font-weight: bold; margin: 10px 0;"></div>
                <div class="success-message" id="voltaSuccess">
                    ğŸ‰ å®Œç’§ï¼ãƒœãƒ«ã‚¿é›»æ± ãŒå®Œæˆã—ã¾ã—ãŸï¼<br>
                    +<span id="voltaPoints">0</span> ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼
                </div>
                <div class="quote-box">
                    ã€Œç§‘å­¦ã¯è¦³å¯Ÿã¨å®Ÿé¨“ã‹ã‚‰å§‹ã¾ã‚‹ã€ - ãƒœãƒ«ã‚¿
                </div>
            </div>
        </div>

        <!-- ç¬¬2ç« ï¼šãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼ -->
        <div class="slide" id="slide2">
            <div class="slide-content">
                <div class="chapter-title">ç¬¬2ç« ï¼šãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼ã®é­”æ³•ã®è¼ª</div>
                <div class="inventor-name">ğŸ‡¬ğŸ‡§ ãƒã‚¤ã‚±ãƒ«ãƒ»ãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼</div>
                <div class="story">
                    ã€Œç£çŸ³ã‚’ä½¿ã£ã¦å‹•ãæ©Ÿæ¢°ã‚’ä½œã‚ŠãŸã„ã‚“ã ï¼<br>
                    ã§ãã‚‹ã ã‘é€Ÿãã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’å‹•ã‹ã—ã¦é›»æ°—ã‚’ä½œã‚ã†ï¼ã€
                </div>
                <div class="mission-box">
                    <div class="mission-title">ğŸ¯ ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼šã‚¹ãƒ”ãƒ¼ãƒ‰ãƒãƒ£ãƒ¬ãƒ³ã‚¸</div>
                    ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ç´ æ—©ãå‹•ã‹ã—ã¦ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ç”Ÿæˆï¼<br>
                    âš¡ ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒé€Ÿã„ã»ã©é«˜å¾—ç‚¹ï¼
                    <div class="challenge-timer" id="faradayTimer">æ®‹ã‚Šæ™‚é–“: --</div>
                </div>
                <div class="faraday-coil">
                    <div class="coil-image" id="coilImage">ğŸ§²</div>
                </div>
                <input type="range" min="0" max="100" value="50" class="magnet-slider" id="magnetSlider">
                <div class="speed-meter">
                    é€Ÿåº¦: <span id="speedDisplay">0</span> km/h
                </div>
                <div class="led-indicator" id="ledIndicator"></div>
                <div style="font-weight: bold; margin: 10px 0;">
                    ç™ºé›»é‡: <span id="energyCount">0</span> / 50
                </div>
                <div class="success-message" id="faradaySuccess">
                    âš¡ é©šç•°çš„ãªã‚¹ãƒ”ãƒ¼ãƒ‰ï¼é›»ç£èª˜å°ã«æˆåŠŸã—ã¾ã—ãŸï¼<br>
                    +<span id="faradayPoints">0</span> ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼
                </div>
                <div class="quote-box">
                    ã€Œä½•ã‚‚ç„¡é§„ãªã“ã¨ã¯ãªã„ã€ã™ã¹ã¦ã¯å­¦ã³ã§ã‚ã‚‹ã€ - ãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼
                </div>
            </div>
        </div>

        <!-- ç¬¬3ç« ï¼šã‚¨ã‚¸ã‚½ãƒ³ -->
        <div class="slide" id="slide3">
            <div class="slide-content">
                <div class="chapter-title">ç¬¬3ç« ï¼šã‚¨ã‚¸ã‚½ãƒ³ã®ä¸çœ ä¸ä¼‘ã®ãƒ©ãƒœ</div>
                <div class="inventor-name">ğŸ‡ºğŸ‡¸ ãƒˆãƒ¼ãƒã‚¹ãƒ»ã‚¨ã‚¸ã‚½ãƒ³</div>
                <div class="story">
                    ã€Œè¡—ä¸­ã«æ˜ã‹ã‚Šã‚’ç¯ã—ãŸã„ãŒã€é…ç·šãŒè¤‡é›‘ã ï¼<br>
                    æ­£ã—ã„é †ç•ªã§è¡—ç¯ã‚’ç‚¹ç¯ã•ã›ã‚ˆã†ï¼ã€
                </div>
                <div class="mission-box">
                    <div class="mission-title">ğŸ¯ ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼šé…ç·šãƒ‘ã‚ºãƒ«</div>
                    1ã‹ã‚‰6ã¾ã§é †ç•ªã«è¡—ç¯ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼<br>
                    âš ï¸ é–“é•ãˆã‚‹ã¨æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—
                    <div class="challenge-timer" id="edisonTimer">æ®‹ã‚Šæ™‚é–“: --</div>
                </div>
                <div class="edison-city" id="edisonCity">
                    <div class="street-light" data-light="1" data-number="1"></div>
                    <div class="street-light" data-light="2" data-number="2"></div>
                    <div class="street-light" data-light="3" data-number="3"></div>
                    <div class="street-light" data-light="4" data-number="4"></div>
                    <div class="street-light" data-light="5" data-number="5"></div>
                    <div class="street-light" data-light="6" data-number="6"></div>
                </div>
                <div class="wire-display">
                    æ¥ç¶šä¸­: <span id="connectionDisplay">--</span>
                </div>
                <div class="success-message" id="edisonSuccess">
                    ğŸ’¡ å®Œç’§ï¼ãƒ‹ãƒ¥ãƒ¼ãƒ¨ãƒ¼ã‚¯ã®è¡—ãŒæ˜ã‚‹ãè¼ã„ã¦ã„ã¾ã™ï¼<br>
                    +<span id="edisonPoints">0</span> ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼
                </div>
                <div class="quote-box">
                    ã€Œå¤±æ•—ã§ã¯ãªã„ã€‚ã†ã¾ãã„ã‹ãªã„1ä¸‡é€šã‚Šã®æ–¹æ³•ã‚’ç™ºè¦‹ã—ãŸã®ã ã€ - ã‚¨ã‚¸ã‚½ãƒ³
                </div>
            </div>
        </div>

        <!-- ç¬¬4ç« ï¼šãƒ†ã‚¹ãƒ© -->
        <div class="slide" id="slide4">
            <div class="slide-content">
                <div class="chapter-title">ç¬¬4ç« ï¼šãƒ†ã‚¹ãƒ©ã¨è‡ªå‹•åˆ¶å¾¡ã®å¤¢</div>
                <div class="inventor-name">ğŸ‡·ğŸ‡¸ ãƒ‹ã‚³ãƒ©ãƒ»ãƒ†ã‚¹ãƒ©</div>
                <div class="story">
                    ã€Œæœªæ¥ã§ã¯ã€è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ©Ÿæ¢°ã‚’åˆ¶å¾¡ã—ãŸã„ï¼<br>
                    å…‰ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜æ†¶ã—ã¦å†ç¾ã—ã‚ˆã†ï¼ã€
                </div>
                <div class="mission-box">
                    <div class="mission-title">ğŸ¯ ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼šãƒ‘ã‚¿ãƒ¼ãƒ³è¨˜æ†¶</div>
                    å…‰ã‚‹ãƒœã‚¿ãƒ³ã®é †ç•ªã‚’è¦šãˆã¦å†ç¾ï¼<br>
                    ğŸŒŸ ãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹ã¨é›£æ˜“åº¦ã‚¢ãƒƒãƒ—
                    <div class="challenge-timer" id="teslaTimer">æ®‹ã‚Šæ™‚é–“: --</div>
                </div>
                <div class="pattern-level">
                    ãƒ¬ãƒ™ãƒ«: <span id="teslaLevel">1</span> / 5
                </div>
                <div class="tesla-panel" id="teslaPanel">
                    <div class="control-button" data-button="0">1</div>
                    <div class="control-button" data-button="1">2</div>
                    <div class="control-button" data-button="2">3</div>
                    <div class="control-button" data-button="3">4</div>
                    <div class="control-button" data-button="4">5</div>
                    <div class="control-button" data-button="5">6</div>
                </div>
                <div class="sequence-display" id="sequenceDisplay">
                    ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¦ãã ã•ã„...
                </div>
                <div class="success-message" id="teslaSuccess">
                    âš™ï¸ å®Œç’§ãªã‚·ãƒ¼ã‚±ãƒ³ã‚¹åˆ¶å¾¡ï¼ã‚ãªãŸã¯å¤©æ‰ã§ã™ï¼<br>
                    +<span id="teslaPoints">0</span> ãƒã‚¤ãƒ³ãƒˆç²å¾—ï¼
                </div>
                <div class="quote-box">
                    ã€Œç¾åœ¨ã¯å½¼ã‚‰ã®ã‚‚ã®ã ã€‚ã—ã‹ã—æœªæ¥ã¯ç§ã®ã‚‚ã®ã ã€ - ãƒ†ã‚¹ãƒ©
                </div>
            </div>
        </div>

        <!-- ã‚¨ãƒ”ãƒ­ãƒ¼ã‚° -->
        <div class="slide" id="slide5">
            <div class="slide-content">
                <h1>ğŸŒŸ ãƒŸãƒƒã‚·ãƒ§ãƒ³å®Œäº†ï¼ ğŸŒŸ</h1>
                <div class="final-score">
                    æœ€çµ‚ã‚¹ã‚³ã‚¢: <span id="finalScore">0</span>
                </div>
                <div class="rank-display" id="rankDisplay"></div>
                <div class="story">
                    <p style="font-size: 1.3em; margin: 20px 0;">
                        å‰äººãŸã¡ã®ã‚µã‚¤ãƒ³ãŒé›†ã¾ã‚Šã€<br>
                        ã€Œå…‰ã®åœ°å›³ã€ãŒå®Œæˆã—ã¾ã—ãŸï¼<br><br>
                        è¡—ã¯å…ƒé€šã‚Šâ€¦â€¦ã„ãˆã€ãã‚Œä»¥ä¸Šã«è¼ã„ã¦ã„ã¾ã™ã€‚
                    </p>
                    <div style="font-size: 4em; margin: 20px 0;">âœ¨ğŸ†âœ¨</div>
                </div>
                <h2 style="color: #e65100; margin: 30px 0;">
                    ãã¿ã‚‚ã€å½¼ã‚‰ã«ç¶šã<br>
                    æ¬¡ã®æ™‚ä»£ã®ç™ºæ˜å®¶ã ï¼
                </h2>
                <div style="font-size: 1.2em; margin: 20px 0;">
                    ã‚ãªãŸãŒå­¦ã‚“ã ã“ã¨ï¼š<br>
                    âš¡ é›»æ± ã®ä»•çµ„ã¿ï¼ˆãƒœãƒ«ã‚¿ï¼‰<br>
                    ğŸ§² é›»ç£èª˜å°ï¼ˆãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼ï¼‰<br>
                    ğŸ’¡ é›»æ°—é…ç·šï¼ˆã‚¨ã‚¸ã‚½ãƒ³ï¼‰<br>
                    âš™ï¸ è‡ªå‹•åˆ¶å¾¡ï¼ˆãƒ†ã‚¹ãƒ©ï¼‰
                </div>
                <button class="retry-button" onclick="location.reload()">
                    ğŸ”„ ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã™ã‚‹
                </button>
            </div>
        </div>
    </div>

    <div class="navigation">
        <button class="nav-button" id="prevBtn" onclick="prevSlide()">â—€ å‰ã¸</button>
        <button class="nav-button" id="nextBtn" onclick="nextSlide()">æ¬¡ã¸ â–¶</button>
    </div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
        let currentSlide = 0;
        const totalSlides = 6;
        let score = 0;
        let lives = 3;
        let combo = 1;
        let difficulty = 'normal';
        let chapterTimers = {};
        let achievements = {
            battery: false,
            induction: false,
            wiring: false,
            control: false,
            master: false
        };

        // é›£æ˜“åº¦è¨­å®š
        const difficultySettings = {
            easy: { timeMultiplier: 2, scoreMultiplier: 0.8 },
            normal: { timeMultiplier: 1, scoreMultiplier: 1 },
            hard: { timeMultiplier: 0.6, scoreMultiplier: 1.5 }
        };

        // ã‚²ãƒ¼ãƒ é–‹å§‹
        function startGame(selectedDifficulty) {
            difficulty = selectedDifficulty;
            document.getElementById('difficultyModal').classList.remove('show');
            currentSlide = 0;
            showSlide(0);
            updateHUD();
            // ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ã§ã¯æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            document.getElementById('nextBtn').disabled = false;
        }

        // HUDæ›´æ–°
        function updateHUD() {
            document.getElementById('score').textContent = score;
            const heartsArray = ['â¤ï¸', 'â¤ï¸', 'â¤ï¸'];
            for (let i = 0; i < 3 - lives; i++) {
                heartsArray[i] = 'ğŸ’”';
            }
            document.getElementById('lives').textContent = heartsArray.join('');
            document.getElementById('combo').textContent = 'Ã—' + combo;
        }

        // ã‚¹ã‚³ã‚¢è¿½åŠ 
        function addScore(points) {
            const multiplier = difficultySettings[difficulty].scoreMultiplier * combo;
            const finalPoints = Math.floor(points * multiplier);
            score += finalPoints;
            updateHUD();
            createParticles(finalPoints);
            return finalPoints;
        }

        // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
        function createParticles(points) {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.textContent = '+' + Math.floor(points / 10);
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    document.body.appendChild(particle);
                    setTimeout(() => particle.remove(), 1000);
                }, i * 50);
            }
        }

        // å®Ÿç¸¾ã‚¢ãƒ³ãƒ­ãƒƒã‚¯
        function unlockAchievement(id) {
            const badge = document.getElementById('badge' + id);
            if (!badge.classList.contains('unlocked')) {
                badge.classList.add('unlocked');
                addScore(500);
                combo++;
                updateHUD();
            }
        }

        // ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
        function startChapterTimer(chapterId, duration) {
            const timerElement = document.getElementById(chapterId + 'Timer');
            let timeLeft = Math.floor(duration * difficultySettings[difficulty].timeMultiplier);
            
            chapterTimers[chapterId] = setInterval(() => {
                timeLeft--;
                timerElement.textContent = 'æ®‹ã‚Šæ™‚é–“: ' + timeLeft + 'ç§’';
                
                if (timeLeft <= 0) {
                    clearInterval(chapterTimers[chapterId]);
                    lives--;
                    updateHUD();
                    if (lives <= 0) {
                        alert('ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã€‚');
                        location.reload();
                    } else {
                        alert('æ™‚é–“åˆ‡ã‚Œï¼æ¬¡ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã«é€²ã¿ã¾ã™ã€‚');
                        nextSlide();
                    }
                }
            }, 1000);
        }

        function stopChapterTimer(chapterId) {
            if (chapterTimers[chapterId]) {
                clearInterval(chapterTimers[chapterId]);
            }
        }

        // ã‚¹ãƒ©ã‚¤ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
        function showSlide(n) {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => slide.classList.remove('active'));
            slides[n].classList.add('active');
            
            document.getElementById('prevBtn').disabled = (n === 0);
            
            // ãƒ—ãƒ­ãƒ­ãƒ¼ã‚°ï¼ˆ0ï¼‰ã¨ã‚¨ãƒ”ãƒ­ãƒ¼ã‚°ï¼ˆ5ï¼‰ã§ã¯æ¬¡ã¸ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
            if (n === 0 || n === 5) {
                document.getElementById('nextBtn').disabled = false;
            } else {
                document.getElementById('nextBtn').disabled = true;
            }
            
            document.getElementById('nextBtn').textContent = (n === totalSlides - 1) ? 'å®Œäº† âœ“' : 'æ¬¡ã¸ â–¶';
            
            const progress = (n / (totalSlides - 1)) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            // ã‚¿ã‚¤ãƒãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
            Object.keys(chapterTimers).forEach(key => stopChapterTimer(key));
            
            // å„ç« ã®åˆæœŸåŒ–
            if (n === 1) initVoltaChallenge();
            if (n === 2) initFaradayChallenge();
            if (n === 3) initEdisonChallenge();
            if (n === 4) initTeslaChallenge();
            if (n === 5) showFinalResults();
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                currentSlide++;
                showSlide(currentSlide);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                stopChapterTimer(['volta', 'faraday', 'edison', 'tesla'][currentSlide - 1]);
                currentSlide--;
                showSlide(currentSlide);
            }
        }

        // ãƒœãƒ«ã‚¿ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆãƒ¡ãƒ¢ãƒªãƒ¼ã‚²ãƒ¼ãƒ ï¼‰
        let voltaPattern = [];
        let voltaUserPattern = [];
        let voltaLevel = 1;

        function initVoltaChallenge() {
            voltaPattern = [];
            voltaUserPattern = [];
            voltaLevel = 1;
            document.getElementById('powerLevel').style.width = '0%';
            document.getElementById('voltaMessage').textContent = 'ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¦ãã ã•ã„...';
            
            startChapterTimer('volta', 60);
            setTimeout(() => showVoltaPattern(), 1000);
        }

        function showVoltaPattern() {
            // æ–°ã—ã„ãƒ©ãƒ³ãƒ€ãƒ ãªç•ªå·ã‚’è¿½åŠ 
            voltaPattern.push(Math.floor(Math.random() * 8));
            voltaUserPattern = [];
            
            let index = 0;
            const interval = setInterval(() => {
                if (index < voltaPattern.length) {
                    const cell = document.querySelector(`[data-cell="${voltaPattern[index]}"]`);
                    cell.classList.add('active');
                    setTimeout(() => cell.classList.remove('active'), 400);
                    index++;
                } else {
                    clearInterval(interval);
                    document.getElementById('voltaMessage').textContent = 'ã‚ãªãŸã®ç•ªã§ã™ï¼';
                    enableVoltaCells();
                }
            }, 600);
        }

        function enableVoltaCells() {
            document.querySelectorAll('.battery-cell').forEach(cell => {
                cell.onclick = function() {
                    const cellNum = parseInt(this.dataset.cell);
                    voltaUserPattern.push(cellNum);
                    
                    this.classList.add('active');
                    setTimeout(() => this.classList.remove('active'), 300);
                    
                    // ãƒã‚§ãƒƒã‚¯
                    const currentIndex = voltaUserPattern.length - 1;
                    if (voltaUserPattern[currentIndex] !== voltaPattern[currentIndex]) {
                        // é–“é•ã„
                        lives--;
                        combo = 1;
                        updateHUD();
                        this.classList.add('wrong');
                        setTimeout(() => this.classList.remove('wrong'), 500);
                        document.getElementById('voltaMessage').textContent = 'âŒ é–“é•ã„ã§ã™ï¼ã‚‚ã†ä¸€åº¦...';
                        
                        if (lives > 0) {
                            setTimeout(() => showVoltaPattern(), 1500);
                        }
                    } else if (voltaUserPattern.length === voltaPattern.length) {
                        // æ­£è§£
                        voltaLevel++;
                        combo++;
                        const progress = (voltaLevel / 6) * 100;
                        document.getElementById('powerLevel').style.width = progress + '%';
                        
                        if (voltaLevel > 5) {
                            stopChapterTimer('volta');
                            const points = addScore(1000);
                            document.getElementById('voltaPoints').textContent = points;
                            document.getElementById('voltaSuccess').classList.add('show');
                            unlockAchievement(1);
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            document.getElementById('voltaMessage').textContent = 'âœ… æ­£è§£ï¼ãƒ¬ãƒ™ãƒ« ' + voltaLevel;
                            setTimeout(() => showVoltaPattern(), 1000);
                        }
                    }
                };
            });
        }

        // ãƒ•ã‚¡ãƒ©ãƒ‡ãƒ¼ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ï¼‰
        let faradayEnergy = 0;
        let lastSliderValue = 50;
        let faradaySpeed = 0;

        function initFaradayChallenge() {
            faradayEnergy = 0;
            lastSliderValue = 50;
            faradaySpeed = 0;
            document.getElementById('energyCount').textContent = '0';
            document.getElementById('speedDisplay').textContent = '0';
            
            startChapterTimer('faraday', 45);
            
            const slider = document.getElementById('magnetSlider');
            slider.value = 50;
            
            slider.oninput = function() {
                const currentValue = parseInt(this.value);
                const diff = Math.abs(currentValue - lastSliderValue);
                faradaySpeed = diff * 10;
                
                document.getElementById('speedDisplay').textContent = faradaySpeed;
                
                if (diff > 3) {
                    faradayEnergy++;
                    document.getElementById('energyCount').textContent = faradayEnergy;
                    
                    const coil = document.getElementById('coilImage');
                    coil.classList.add('energized');
                    setTimeout(() => coil.classList.remove('energized'), 200);
                    
                    const led = document.getElementById('ledIndicator');
                    led.classList.add('on');
                    setTimeout(() => led.classList.remove('on'), 150);
                    
                    if (faradayEnergy >= 50) {
                        stopChapterTimer('faraday');
                        const speedBonus = faradaySpeed > 200 ? 500 : 0;
                        const points = addScore(1000 + speedBonus);
                        document.getElementById('faradayPoints').textContent = points;
                        document.getElementById('faradaySuccess').classList.add('show');
                        unlockAchievement(2);
                        document.getElementById('nextBtn').disabled = false;
                        slider.oninput = null;
                    }
                }
                
                lastSliderValue = currentValue;
            };
        }

        // ã‚¨ã‚¸ã‚½ãƒ³ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆé †ç•ªãƒ‘ã‚ºãƒ«ï¼‰
        let edisonSequence = [];
        let edisonExpected = 1;

        function initEdisonChallenge() {
            edisonSequence = [];
            edisonExpected = 1;
            document.getElementById('connectionDisplay').textContent = '--';
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«é…ç½®
            const lights = Array.from(document.querySelectorAll('.street-light'));
            lights.forEach(light => {
                light.classList.remove('powered');
                light.style.order = Math.random();
            });
            
            startChapterTimer('edison', 50);
            
            lights.forEach(light => {
                light.onclick = function() {
                    const lightNum = parseInt(this.dataset.light);
                    
                    if (lightNum === edisonExpected) {
                        this.classList.add('powered');
                        edisonSequence.push(lightNum);
                        edisonExpected++;
                        document.getElementById('connectionDisplay').textContent = edisonSequence.join(' â†’ ');
                        combo++;
                        updateHUD();
                        
                        if (edisonSequence.length === 6) {
                            stopChapterTimer('edison');
                            const points = addScore(1200);
                            document.getElementById('edisonPoints').textContent = points;
                            document.getElementById('edisonSuccess').classList.add('show');
                            unlockAchievement(3);
                            document.getElementById('nextBtn').disabled = false;
                        }
                    } else {
                        lives--;
                        combo = 1;
                        updateHUD();
                        
                        lights.forEach(l => l.classList.remove('powered'));
                        edisonSequence = [];
                        edisonExpected = 1;
                        document.getElementById('connectionDisplay').textContent = 'âŒ ã‚„ã‚Šç›´ã—ï¼';
                        
                        setTimeout(() => {
                            document.getElementById('connectionDisplay').textContent = '--';
                        }, 1000);
                    }
                };
            });
        }

        // ãƒ†ã‚¹ãƒ©ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆã‚µã‚¤ãƒ¢ãƒ³ã‚²ãƒ¼ãƒ ï¼‰
        let teslaPattern = [];
        let teslaUserInput = [];
        let teslaCurrentLevel = 1;
        let teslaIsShowing = false;

        function initTeslaChallenge() {
            teslaPattern = [];
            teslaUserInput = [];
            teslaCurrentLevel = 1;
            document.getElementById('teslaLevel').textContent = '1';
            
            startChapterTimer('tesla', 90);
            setTimeout(() => showTeslaPattern(), 1000);
        }

        function showTeslaPattern() {
            teslaIsShowing = true;
            teslaPattern.push(Math.floor(Math.random() * 6));
            teslaUserInput = [];
            
            document.getElementById('sequenceDisplay').textContent = 'ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¦ãã ã•ã„...';
            
            let index = 0;
            const interval = setInterval(() => {
                if (index < teslaPattern.length) {
                    const button = document.querySelector(`[data-button="${teslaPattern[index]}"]`);
                    button.classList.add('flash');
                    setTimeout(() => button.classList.remove('flash'), 400);
                    index++;
                } else {
                    clearInterval(interval);
                    teslaIsShowing = false;
                    document.getElementById('sequenceDisplay').textContent = 'ã‚ãªãŸã®ç•ªã§ã™ï¼';
                    enableTeslaButtons();
                }
            }, 700);
        }

        function enableTeslaButtons() {
            document.querySelectorAll('.control-button').forEach(button => {
                button.onclick = function() {
                    if (teslaIsShowing) return;
                    
                    const buttonNum = parseInt(this.dataset.button);
                    teslaUserInput.push(buttonNum);
                    
                    this.classList.add('activated');
                    setTimeout(() => this.classList.remove('activated'), 300);
                    
                    const currentIndex = teslaUserInput.length - 1;
                    if (teslaUserInput[currentIndex] !== teslaPattern[currentIndex]) {
                        lives--;
                        combo = 1;
                        updateHUD();
                        
                        this.classList.add('error');
                        setTimeout(() => this.classList.remove('error'), 500);
                        
                        document.getElementById('sequenceDisplay').textContent = 'âŒ é–“é•ã„ï¼ã‚‚ã†ä¸€åº¦...';
                        
                        if (lives > 0) {
                            setTimeout(() => showTeslaPattern(), 1500);
                        }
                    } else if (teslaUserInput.length === teslaPattern.length) {
                        teslaCurrentLevel++;
                        combo++;
                        document.getElementById('teslaLevel').textContent = teslaCurrentLevel;
                        
                        if (teslaCurrentLevel > 5) {
                            stopChapterTimer('tesla');
                            const points = addScore(1500);
                            document.getElementById('teslaPoints').textContent = points;
                            document.getElementById('teslaSuccess').classList.add('show');
                            unlockAchievement(4);
                            document.getElementById('nextBtn').disabled = false;
                        } else {
                            document.getElementById('sequenceDisplay').textContent = 'âœ… æ­£è§£ï¼æ¬¡ã®ãƒ¬ãƒ™ãƒ«...';
                            setTimeout(() => showTeslaPattern(), 1500);
                        }
                    }
                };
            });
        }

        // æœ€çµ‚çµæœè¡¨ç¤º
        function showFinalResults() {
            document.getElementById('finalScore').textContent = score;
            
            let rank, rankClass, message;
            if (score >= 8000) {
                rank = 'S';
                rankClass = 'rank-s';
                message = 'ğŸ‘‘ æ™‚ç©ºåˆ¶è¦‡ï¼ã‚ãªãŸã¯çœŸã®å¤©æ‰ã§ã™ï¼';
                unlockAchievement(5);
            } else if (score >= 6000) {
                rank = 'A';
                rankClass = 'rank-a';
                message = 'â­ ç´ æ™´ã‚‰ã—ã„ï¼å‰äººãŸã¡ã‚‚æ„Ÿå‹•ã—ã¦ã„ã¾ã™ï¼';
            } else if (score >= 4000) {
                rank = 'B';
                rankClass = 'rank-b';
                message = 'âœ¨ ã‚ˆãã§ãã¾ã—ãŸï¼ã‚‚ã†å°‘ã—ã§å®Œç’§ã§ã™ï¼';
            } else {
                rank = 'C';
                rankClass = 'rank-c';
                message = 'ğŸ’ª é ‘å¼µã‚Šã¾ã—ãŸï¼ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¦ã¿ã‚ˆã†ï¼';
            }
            
            document.getElementById('rankDisplay').innerHTML = 
                `<span class="${rankClass}">ãƒ©ãƒ³ã‚¯: ${rank}</span><br>${message}`;
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowRight' && !document.getElementById('nextBtn').disabled) nextSlide();
            if (e.key === 'ArrowLeft' && !document.getElementById('prevBtn').disabled) prevSlide();
        });

        // åˆæœŸåŒ–
        updateHUD();
    </script>
</body>
</html>