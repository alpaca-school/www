<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>2æœˆ 1æ—¥ãƒˆãƒ¼ã‚¿ãƒ«å¥åº·ç®¡ç†è¡¨ï¼ˆä¸‰è‰²é£Ÿå“ç¾¤ï¼‹è¡€æ¶²æ•°å€¤ï¼‰</title>
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', sans-serif;
            line-height: 1.4;
            color: #333;
            max-width: 1400px;
            margin: 20px auto;
            background-color: #f0f4f8;
            padding: 10px;
        }

        h1 {
            text-align: center;
            color: #1e3a5f;
        }

        .base-info {
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 5px solid #27ae60;
            font-size: 0.85em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            table-layout: fixed;
        }

        th,
        td {
            border: 1px solid #eee;
            padding: 6px;
            font-size: 0.7em;
            overflow: hidden;
            vertical-align: middle;
        }

        th {
            background-color: #1e3a5f;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .aka {
            color: #e74c3c;
            font-weight: bold;
        }

        .ki {
            color: #f39c12;
            font-weight: bold;
        }

        .midori {
            color: #27ae60;
            font-weight: bold;
        }

        .date-col {
            width: 50px;
            text-align: center;
            font-weight: bold;
        }

        .menu-col {
            width: 220px;
        }

        .num-col {
            text-align: right;
            width: 60px;
        }

        .judge-col {
            width: 80px;
            text-align: center;
        }

        .over {
            color: #e74c3c;
            font-weight: bold;
        }

        .status {
            padding: 2px 5px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 0.7em;
            display: block;
        }

        .caution {
            background-color: #ffcccc;
            color: #c0392b;
        }

        .good {
            background-color: #d5f5e3;
            color: #27ae60;
        }

        .care {
            background-color: #ffeaa7;
            color: #d35400;
        }

        /* Checkbox & Toggle Styles */
        .check-col {
            width: 60px;
            text-align: center;
        }

        .bk-toggle {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 8px 0;
            background: #eee;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: bold;
            color: #7f8c8d;
            transition: all 0.2s ease;
            user-select: none;
            border: 1px solid #ddd;
        }

        .bk-toggle input {
            display: none;
        }

        .bk-toggle.active {
            background: #ffeaa7;
            color: #d35400;
            border-color: #f39c12;
            box-shadow: 0 2px 4px rgba(243, 156, 18, 0.3);
        }

        /* Night Menu List Styles */
        .menu-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .menu-item-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 0.95em;
            padding: 3px 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .menu-item-label:hover {
            background-color: #f8f9fa;
        }

        .menu-item-label input {
            margin-right: 6px;
            transform: scale(1.2);
            cursor: pointer;
        }

        .menu-item-label.checked {
            text-decoration: none;
            color: #333;
            font-weight: bold;
        }

        .menu-item-label.unchecked {
            color: #aaa;
            text-decoration: line-through;
        }

        .num-val {
            font-size: 1.1em;
            font-weight: bold;
        }

        .progress-bar {
            height: 4px;
            background: #eee;
            border-radius: 2px;
            margin-top: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            transition: width 0.5s ease;
        }
    </style>
</head>

<body>

    <h1>ğŸ“Š 2æœˆ å¥åº·ç®¡ç†è¡¨ï¼ˆæœï¼šã™ãå®¶ ï¼‹ å¤œï¼šå­¦æ ¡çµ¦é£Ÿï¼‰</h1>

    <div class="base-info">
        <strong>ã€æœã€‘ã™ãå®¶ã€Œå¡©ã‚µãƒãŸã¾ã‹ã‘å®šé£ŸãƒŸãƒ‹ã€å›ºå®š</strong> (557kcal / è„‚è³ª 23.9g / ç‚­æ°´åŒ–ç‰© 61.3g)<br>
        <strong>ã€å¤œã€‘å­¦æ ¡çµ¦é£Ÿãƒ¡ãƒ‹ãƒ¥ãƒ¼å€‹åˆ¥ã«ãƒã‚§ãƒƒã‚¯å¯èƒ½</strong> (ã”é£¯ã¯150g=252kcalã§è¨ˆç®—)<br>
        <div style="margin-top:5px; font-size:0.9em; color:#555;">
            â€»é£Ÿã¹ãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚æ „é¤Šä¾¡ã¯è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™ã€‚
        </div>
    </div>

    <!-- Data Management Area -->
    <div class="data-mgmt"
        style="background:#fff; padding:15px; margin-bottom:20px; border-radius:8px; box-shadow:0 2px 5px rgba(0,0,0,0.1); border-left: 5px solid #3498db;">
        <h3 style="margin-top:0; font-size:1em; color:#2c3e50;">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿</h3>
        <textarea id="io-area"
            style="width:100%; height:60px; margin-bottom:10px; border:1px solid #ccc; font-family:monospace; font-size:0.8em; padding:5px;"
            placeholder="ã€æ›¸ãå‡ºã—ã€‘ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã“ã“ã«ãƒ†ã‚­ã‚¹ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ä¿å­˜ã™ã‚‹å ´åˆã¯ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚&#10;ã€èª­ã¿è¾¼ã¿ã€‘ä»¥å‰ä¿å­˜ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’ã“ã“ã«è²¼ã‚Šä»˜ã‘ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚"></textarea>
        <div>
            <button id="btn-export"
                style="padding:6px 12px; background:#3498db; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold;">ğŸ“¤
                ç¾åœ¨ã®çŠ¶æ…‹ã‚’ãƒ†ã‚­ã‚¹ãƒˆåŒ–ï¼ˆæ›¸ãå‡ºã—ï¼‰</button>
            <button id="btn-import"
                style="padding:6px 12px; background:#e67e22; color:white; border:none; border-radius:4px; cursor:pointer; font-weight:bold; margin-left:10px;">ğŸ“¥
                ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å¾©å…ƒï¼ˆèª­ã¿è¾¼ã¿ï¼‰</button>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th class="date-col">æ—¥ä»˜</th>
                <th class="check-col">æœé£Ÿ</th>
                <th class="menu-col">ã€å¤œã€‘ãƒ¡ãƒ‹ãƒ¥ãƒ¼è©³ç´°ï¼ˆé¸æŠå¯ï¼‰</th>
                <th class="aka">èµ¤ï¼ˆè¡€ãƒ»è‚‰ï¼‰</th>
                <th class="ki">é»„ï¼ˆç†±ãƒ»åŠ›ï¼‰</th>
                <th class="midori">ç·‘ï¼ˆèª¿å­ï¼‰</th>
                <th class="num-col">åˆè¨ˆkcal</th>
                <th class="num-col">åˆè¨ˆè„‚è³ª</th>
                <th class="num-col">åˆè¨ˆç‚­æ°´</th>
                <th class="judge-col">åˆ¤å®š</th>
                <th>è¡€æ¶²æ•°å€¤ã‚¢ãƒ‰ãƒã‚¤ã‚¹</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>2/2</td>
                <td>ã€å¤œã€‘ãƒã‚­ãƒ³ã‚«ãƒ„ã€å’Œãˆç‰©ã€ã²ã˜ãç…®</td>
                <td>é¶è‚‰ã€ã²ã˜ãã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€ãƒ‘ãƒ³ç²‰ã€æ²¹</td>
                <td>ç™½èœã€äººå‚ã€å°æ¾èœ</td>
                <td class="num-col">1407</td>
                <td class="num-col over">51.9g</td>
                <td class="num-col">171.3g</td>
                <td><span class="status caution">ğŸš« è­¦æˆ’</span></td>
                <td>æšã’æ²¹ã¯ALT/LDLã‚’ä¸Šæ˜‡ã€‚å¤œã¯è’¸ã—æ–™ç†ã§ã€‚</td>
            </tr>
            <tr>
                <td>2/3</td>
                <td>ã€å¤œã€‘ç‰›è‚‰å‘³å™Œç‚’ã‚ã€ç”˜é…¢å’Œãˆ</td>
                <td>ç‰›è‚‰ã€å‘³å™Œã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€ç ‚ç³–</td>
                <td>ãƒã‚®ã€å¤§æ ¹ã€ãã‚…ã†ã‚Š</td>
                <td class="num-col">1337</td>
                <td class="num-col">45.9g</td>
                <td class="num-col">166.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>ç‰›è„‚ã¯LDLã«å½±éŸ¿ã€‚å¤§æ ¹ã®é£Ÿç‰©ç¹Šç¶­ã‚’æ‘‚å–ã€‚</td>
            </tr>
            <tr>
                <td>2/4</td>
                <td>ã€å¤œã€‘é†¤æ²¹ãƒ©ãƒ¼ãƒ¡ãƒ³ã€æšã’é¤ƒå­ã€ç±³</td>
                <td>è±šè‚‰ã€ã‚µãƒã€åµ</td>
                <td>éººã€ç±³ã€çš®ã€æ²¹</td>
                <td>ã‚‚ã‚„ã—ã€ãƒã‚®ã€ãƒ¡ãƒ³ãƒ</td>
                <td class="num-col">1277</td>
                <td class="num-col">41.9g</td>
                <td class="num-col over">176.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>ãƒ€ãƒ–ãƒ«ç‚­æ°´åŒ–ç‰©ã¯ä¸­æ€§è„‚è‚ªã¸ã€‚å¤œã¯ç±³æŠœãã€‚</td>
            </tr>
            <tr>
                <td>2/5</td>
                <td>ã€å¤œã€‘éº»å©†è±†è…ä¸¼ã€ãƒãƒ³ã‚µãƒ³ã‚¹ãƒ¼</td>
                <td>è±†è…ã€è‚‰ã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€æ²¹ã€ç‰‡æ —ç²‰</td>
                <td>ãã‚…ã†ã‚Šã€äººå‚ã€ãƒã‚®</td>
                <td class="num-col">1307</td>
                <td class="num-col">43.9g</td>
                <td class="num-col">171.3g</td>
                <td><span class="status good">âœ… è‰¯å¥½</span></td>
                <td>å¤§è±†ã‚¿ãƒ³ãƒ‘ã‚¯ãŒè‚æ©Ÿèƒ½ã‚’ã‚µãƒãƒ¼ãƒˆã€‚</td>
            </tr>
            <tr>
                <td>2/6</td>
                <td>ã€å¤œã€‘ã‚µãƒå¡©ç„¼ãã€é’èœç‚’ã‚</td>
                <td>ã‚µãƒ(æœå¤œ)ã€åµã€å‘³å™Œ</td>
                <td>ç±³ã€æ²¹</td>
                <td>ã‚­ãƒ£ãƒ™ãƒ„ã€é’èœã€äººå‚</td>
                <td class="num-col">1257</td>
                <td class="num-col">41.9g</td>
                <td class="num-col">156.3g</td>
                <td><span class="status good">âœ… è‰¯å¥½</span></td>
                <td>ã‚µãƒã®æ²¹ã§HDLä¸Šæ˜‡ãƒ»ä¸­æ€§è„‚è‚ªä½ä¸‹ã€‚</td>
            </tr>
            <tr>
                <td>2/9</td>
                <td>ã€å¤œã€‘ã‚¯ãƒªãƒ¼ãƒ ã‚·ãƒãƒ¥ãƒ¼ã€ãƒŠã‚²ãƒƒãƒˆ</td>
                <td>é¶ã€ä¹³è£½å“ã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€èŠ‹ã€å°éº¦ç²‰ã€æ²¹</td>
                <td>ç‰ã­ãã€äººå‚ã€ç”Ÿé‡èœ</td>
                <td class="num-col">1377</td>
                <td class="num-col">48.9g</td>
                <td class="num-col over">176.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>å‹•ç‰©æ€§è„‚è³ªã‚ã‚Šã€‚å¤œã¯é‡èœã‚¹ãƒ¼ãƒ—æ¨å¥¨ã€‚</td>
            </tr>
            <tr>
                <td>2/12</td>
                <td>ã€å¤œã€‘ã•ã•ã¿ãƒãƒ¼ã‚ºãƒ•ãƒ©ã‚¤ã€ç­‘å‰ç…®</td>
                <td>ã•ã•ã¿ã€ãƒãƒ¼ã‚ºã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€ãƒ‘ãƒ³ç²‰ã€æ²¹ã€é‡ŒèŠ‹</td>
                <td>ã‚­ãƒ£ãƒ™ãƒ„ã€äººå‚ã€ç‰›è’¡</td>
                <td class="num-col">1387</td>
                <td class="num-col over">49.9g</td>
                <td class="num-col">166.3g</td>
                <td><span class="status caution">ğŸš« è­¦æˆ’</span></td>
                <td>æšã’ç‰©Ã—ãƒãƒ¼ã‚ºã¯ALTè² æ‹…ã€‚å¤œã¯ç´è±†ã€‚</td>
            </tr>
            <tr>
                <td>2/13</td>
                <td>ã€å¤œã€‘ãƒãƒ³ãƒãƒ¼ã‚°ã€æµ·è€ãƒ•ãƒ©ã‚¤</td>
                <td>è‚‰ã€æµ·è€ã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€ãƒ‘ãƒ³ç²‰ã€æ²¹ã€ç ‚ç³–</td>
                <td>ã‚¤ãƒ³ã‚²ãƒ³ã€äººå‚ã€æœç‰©</td>
                <td class="num-col over">1507</td>
                <td class="num-col over">58.9g</td>
                <td class="num-col over">181.3g</td>
                <td><span class="status caution">ğŸš« è­¦æˆ’</span></td>
                <td>æœ€å¤§è„‚è³ªæ—¥ã€‚å¤œã¯ä¸»é£ŸæŠœãï¼†ä½è„‚è³ªã§ã€‚</td>
            </tr>
            <tr>
                <td>2/16</td>
                <td>ã€å¤œã€‘ãƒã‚­ãƒ³ã‚«ãƒ¬ãƒ¼ã€ãƒãƒ†ãƒˆãƒ•ãƒ©ã‚¤</td>
                <td>é¶ã€ã‚µãƒã€åµã€è„±è„‚ç²‰ä¹³</td>
                <td>ç±³ã€èŠ‹ã€ãƒ«ãƒ¼ã€æ²¹</td>
                <td>ç‰ã­ãã€äººå‚ã€ç‰›è’¡</td>
                <td class="num-col">1437</td>
                <td class="num-col">47.9g</td>
                <td class="num-col over">191.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>ç³–è³ªéå¤šã€‚ä¸­æ€§è„‚è‚ªå¯¾ç­–ã«å¤œã¯æ­©ãç­‰ã€‚</td>
            </tr>
            <tr>
                <td>2/17</td>
                <td>ã€å¤œã€‘ç‰›ä¸¼ã€ãŠãã‚‰ç…®ã³ãŸã—</td>
                <td>ç‰›è‚‰ã€å‘³å™Œã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€ç ‚ç³–</td>
                <td>ç‰ã­ãã€ãŠãã‚‰ã€äººå‚</td>
                <td class="num-col">1357</td>
                <td class="num-col">45.9g</td>
                <td class="num-col over">181.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>ãŠãã‚‰ã®é£Ÿç‰©ç¹Šç¶­ãŒç³–ã®å¸åã‚’ç·©å’Œã€‚</td>
            </tr>
            <tr>
                <td>2/18</td>
                <td>ã€å¤œã€‘æ²–ç¸„ãã°ã€ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼</td>
                <td>è±šã€ã‹ã¾ã¼ã“ã€ã‚µãƒã€åµ</td>
                <td>éººã€ç±³ã€æ²¹</td>
                <td>ãƒã‚®ã€äººå‚ã€ã‚‚ãšã</td>
                <td class="num-col">1407</td>
                <td class="num-col">43.9g</td>
                <td class="num-col over">196.3g</td>
                <td><span class="status caution">ğŸš« è­¦æˆ’</span></td>
                <td>ç‚­æ°´åŒ–ç‰©æœ€å¤§ã€‚ä¸­æ€§è„‚è‚ªä¸Šæ˜‡ã®ãƒªã‚¹ã‚¯ã€‚</td>
            </tr>
            <tr>
                <td>2/19</td>
                <td>ã€å¤œã€‘ç™½èº«é­šãƒ•ãƒ©ã‚¤ã€é¶æ±</td>
                <td>ç™½èº«é­šã€é¶ã€ãƒ„ãƒŠã€ã‚µãƒ</td>
                <td>ç±³ã€ãƒ‘ãƒ³ç²‰ã€æ²¹</td>
                <td>ç™½èœã€å¤§æ ¹ã€ã‚­ãƒ£ãƒ™ãƒ„</td>
                <td class="num-col">1337</td>
                <td class="num-col">45.9g</td>
                <td class="num-col">161.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>é­šã ãŒæšã’ç‰©ã€‚å¤œã¯ç…®é­šç­‰ã§è„‚è³ªèª¿æ•´ã€‚</td>
            </tr>
            <tr>
                <td>2/20</td>
                <td>ã€å¤œã€‘ã¨ã‚“ã‹ã¤ã€ãƒã‚«ãƒ­ãƒ‹ã‚µãƒ©ãƒ€</td>
                <td>è±šè‚‰ã€ãƒãƒ ã€å‘³å™Œã€ã‚µãƒ</td>
                <td>ç±³ã€ãƒ‘ãƒ³ç²‰ã€ãƒã‚«ãƒ­ãƒ‹ã€æ²¹</td>
                <td>ãƒ–ãƒ­ãƒƒã‚³ãƒªãƒ¼ã€ã‚­ãƒ£ãƒ™ãƒ„</td>
                <td class="num-col">1457</td>
                <td class="num-col over">55.9g</td>
                <td class="num-col">171.3g</td>
                <td><span class="status caution">ğŸš« è­¦æˆ’</span></td>
                <td>è‚è‡“ã«è² æ‹…ã€‚å¤œã¯æ°´åˆ†å¤šã‚ã§ä»£è¬ä¿ƒé€²ã€‚</td>
            </tr>
            <tr>
                <td>2/24</td>
                <td>ã€å¤œã€‘ãƒãƒ¤ã‚·ãƒ©ã‚¤ã‚¹ã€ãƒŸãƒ¼ãƒˆãƒœãƒ¼ãƒ«</td>
                <td>è±šã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€ãƒ«ãƒ¼ã€æ²¹</td>
                <td>ç‰ã­ãã€äººå‚ã€ã»ã†ã‚Œã‚“è‰</td>
                <td class="num-col">1377</td>
                <td class="num-col">46.9g</td>
                <td class="num-col over">186.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>ç³–è³ªãƒ»è„‚è³ªå…±ã€‚å¤œã¯ç·‘é»„è‰²é‡èœã‚’ä¸­å¿ƒã«ã€‚</td>
            </tr>
            <tr>
                <td>2/25</td>
                <td>ã€å¤œã€‘ãƒŸãƒ¼ãƒˆã‚½ãƒ¼ã‚¹ã‚¹ãƒ‘ã€ã‚³ãƒ­ãƒƒã‚±</td>
                <td>è±šã€ãƒãƒ¼ã‚ºã€é¶ã€ã‚µãƒ</td>
                <td>éººã€ç±³ã€ãƒ‘ãƒ³ç²‰ã€æ²¹ã€èŠ‹</td>
                <td>ç‰ã­ãã€äººå‚ã€ç”Ÿé‡èœ</td>
                <td class="num-col">1357</td>
                <td class="num-col">45.9g</td>
                <td class="num-col over">176.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>éººã¨ãƒ‘ãƒ³ç²‰ã®é‡ãªã‚Šã€‚å¤œã¯è»½ãã€‚</td>
            </tr>
            <tr>
                <td>2/26</td>
                <td>ã€å¤œã€‘å…«å®èœã€ãƒ›ã‚¿ãƒ†ãƒ•ãƒ©ã‚¤</td>
                <td>è±šã€çƒè³Šã€æµ·è€ã€è²ã€åµ</td>
                <td>ç±³ã€ç‰‡æ —ç²‰ã€æ²¹</td>
                <td>ç™½èœã€ç­ã€äººå‚</td>
                <td class="num-col">1297</td>
                <td class="num-col">41.9g</td>
                <td class="num-col">166.3g</td>
                <td><span class="status good">âœ… è‰¯å¥½</span></td>
                <td>é­šä»‹ã®ã‚¿ã‚¦ãƒªãƒ³ãŒè‚è‡“ï¼ˆALTï¼‰ã‚’ä¿è­·ã€‚</td>
            </tr>
            <tr>
                <td>2/27</td>
                <td>ã€å¤œã€‘ãƒ“ãƒ¼ãƒ•ã‚·ãƒãƒ¥ãƒ¼ã€ã‚³ãƒ­ãƒƒã‚±</td>
                <td>ç‰›è‚‰ã€ã‚µãƒã€åµ</td>
                <td>ç±³ã€èŠ‹ã€ãƒ«ãƒ¼ã€ãƒ‘ãƒ³ç²‰ã€æ²¹</td>
                <td>ç‰ã­ãã€äººå‚ã€ã‚­ãƒ£ãƒ™ãƒ„</td>
                <td class="num-col">1407</td>
                <td class="num-col over">49.9g</td>
                <td class="num-col over">176.3g</td>
                <td><span class="status care">âš ï¸ æ³¨æ„</span></td>
                <td>è„‚è³ªéå¤šã€‚å¤œã¯å†·å¥´ç­‰ã§ã‚¿ãƒ³ãƒ‘ã‚¯è³ªã®ã¿ã€‚</td>
            </tr>
        </tbody>
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const BK_FIXED = { kcal: 557, fat: 23.9, carb: 61.3 };
            const RICE_FIXED = { kcal: 252, fat: 0.5, carb: 55.7 }; // Approx 150g Rice

            const table = document.querySelector('table');
            const rows = table.querySelectorAll('tbody tr');

            rows.forEach(row => {
                // Determine existing cells BEFORE insertion
                // Indices: 0:Date, 1:Menu, 2:Red, 3:Yellow, 4:Green, 5:Kcal, 6:Fat, 7:Carb
                const menuCell = row.cells[1];
                const kcalCell = row.cells[5];
                const fatCell = row.cells[6];
                const carbCell = row.cells[7];

                // 1. Parse Plan Values (Total of Day from HTML)
                const planKcal = parseFloat(kcalCell.textContent.replace(/[^0-9.]/g, '')) || 0;
                const planFat = parseFloat(fatCell.textContent.replace(/[^0-9.]/g, '')) || 0;
                const planCarb = parseFloat(carbCell.textContent.replace(/[^0-9.]/g, '')) || 0;

                row.dataset.planKcal = planKcal;

                // 2. Calculate "Night Total" (Plan - Breakfast) and clamp to 0
                let nightTotalKcal = Math.max(0, planKcal - BK_FIXED.kcal);
                let nightTotalFat = Math.max(0, planFat - BK_FIXED.fat);
                let nightTotalCarb = Math.max(0, planCarb - BK_FIXED.carb);

                // 3. Insert Check Column at Index 1
                const bkCell = row.insertCell(1);
                bkCell.className = "check-col";
                bkCell.innerHTML = `
                    <label class="bk-toggle">
                        <input type="checkbox" class="check-bk"> <span>æœ</span>
                    </label>
                `;

                // 4. Parse Menu Items and Create Checkboxes
                let menuText = menuCell.textContent.replace('ã€å¤œã€‘', '').trim();
                let items = menuText.split('ã€').map(s => s.trim()).filter(s => s);

                // --- Distribution Logic ---
                // If "Rice/ç±³" exists, assign FIXED Rice values to it.
                // Subtract Rice values from the Night Total.
                // Distribute remainder equally among other items.

                let riceItemIndex = items.findIndex(item => item.includes('ç±³') || item.includes('ã”ã¯ã‚“') || item.includes('ã”é£¯'));
                let otherItemCount = (riceItemIndex >= 0) ? items.length - 1 : items.length;
                if (otherItemCount < 1) otherItemCount = 1; // Fallback

                // Adjust totals for remaining distribution
                let distKcal = nightTotalKcal;
                let distFat = nightTotalFat;
                let distCarb = nightTotalCarb;

                if (riceItemIndex >= 0) {
                    distKcal -= RICE_FIXED.kcal;
                    distFat -= RICE_FIXED.fat;
                    distCarb -= RICE_FIXED.carb;
                }

                // If values go negative, clamp to 0
                distKcal = Math.max(0, distKcal);
                distFat = Math.max(0, distFat);
                distCarb = Math.max(0, distCarb);

                // Calculate per-item (non-rice) values
                let perItemKcal = distKcal / otherItemCount;
                let perItemFat = distFat / otherItemCount;
                let perItemCarb = distCarb / otherItemCount;

                // Build Item Data Structure
                let menuData = items.map((name, index) => {
                    let isRice = (index === riceItemIndex);
                    return {
                        name: name,
                        kcal: isRice ? RICE_FIXED.kcal : perItemKcal,
                        fat: isRice ? RICE_FIXED.fat : perItemFat,
                        carb: isRice ? RICE_FIXED.carb : perItemCarb
                    };
                });

                // Clear Menu Cell and Render Checkboxes
                menuCell.innerHTML = `<div class="menu-list"></div>`;
                const menuList = menuCell.querySelector('.menu-list');

                menuData.forEach((item, idx) => {
                    const label = document.createElement('label');
                    label.className = 'menu-item-label unchecked';
                    label.innerHTML = `<input type="checkbox" class="night-item-check" data-idx="${idx}"> ${item.name}`;

                    // Store metrics in the input element
                    const input = label.querySelector('input');
                    input.dataset.kcal = item.kcal;
                    input.dataset.fat = item.fat;
                    input.dataset.carb = item.carb;

                    // Row-level listener wrapper
                    input.addEventListener('change', (e) => {
                        const lbl = e.target.parentElement;
                        if (e.target.checked) {
                            lbl.classList.remove('unchecked');
                            lbl.classList.add('checked');
                        } else {
                            lbl.classList.remove('checked');
                            lbl.classList.add('unchecked');
                        }
                        updateRow(row);
                    });

                    menuList.appendChild(label);
                });

                // Listener for Breakfast
                const bkInput = bkCell.querySelector('input');
                bkInput.addEventListener('change', (e) => {
                    const btn = e.target.parentElement;
                    if (e.target.checked) btn.classList.add('active');
                    else btn.classList.remove('active');
                    updateRow(row);
                });

                // Initial Update
                updateRow(row);
            });

            function updateRow(row) {
                // Get Breakfast Status
                const bkChecked = row.querySelector('.check-bk').checked;

                // Get Night Status (Sum of checked items)
                const nightChecks = row.querySelectorAll('.night-item-check:checked');

                let currentKcal = 0;
                let currentFat = 0;
                let currentCarb = 0;

                // Add Breakfast
                if (bkChecked) {
                    currentKcal += BK_FIXED.kcal;
                    currentFat += BK_FIXED.fat;
                    currentCarb += BK_FIXED.carb;
                }

                // Add Night Items
                nightChecks.forEach(chk => {
                    currentKcal += parseFloat(chk.dataset.kcal);
                    currentFat += parseFloat(chk.dataset.fat);
                    currentCarb += parseFloat(chk.dataset.carb);
                });

                // Update Display
                // Indices shifted by +1 because of new column insertion
                // Old 5->New 6, Old 6->New 7, Old 7->New 8
                const kCell = row.cells[6];
                const fCell = row.cells[7];
                const cCell = row.cells[8];
                const planKcal = parseFloat(row.dataset.planKcal);

                // Percentage
                const pct = planKcal > 0 ? (currentKcal / planKcal) * 100 : 0;

                kCell.innerHTML = `<div class="num-val">${Math.round(currentKcal)}</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(100, pct)}%; background-color: ${getBarColor(currentKcal, planKcal)}"></div></div>`;
                fCell.innerHTML = `<div class="num-val">${currentFat.toFixed(1)}g</div>`;
                cCell.innerHTML = `<div class="num-val">${currentCarb.toFixed(1)}g</div>`;

                // Dynamic Over/Warning Styling
                // Re-creating logic: Fat > 50 is bad? Carb > 175 is bad?
                const fatLimit = 50;
                const carbLimit = 175;

                if (currentFat >= fatLimit) fCell.classList.add('over'); else fCell.classList.remove('over');
                if (currentCarb >= carbLimit) cCell.classList.add('over'); else cCell.classList.remove('over');
            }

            function getBarColor(current, max) {
                const pct = current / max;
                if (pct < 0.5) return '#f1c40f'; // Yellow
                if (pct < 1.0) return '#2ecc71'; // Green
                return '#e74c3c'; // Red (Full)
            }

            // --- Data Export ---
            document.getElementById('btn-export').addEventListener('click', () => {
                const data = {};
                rows.forEach(row => {
                    const date = row.cells[0].innerText.trim();
                    const bkChecked = row.querySelector('.check-bk').checked;
                    // Night items are dynamic
                    const nightChecks = Array.from(row.querySelectorAll('.night-item-check')).map(c => c.checked);

                    data[date] = {
                        bk: bkChecked,
                        night: nightChecks
                    };
                });

                // Pretty print for readability, though less compact
                document.getElementById('io-area').value = JSON.stringify(data);
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãå‡ºã—ã¾ã—ãŸã€‚ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã—ã¦ãã ã•ã„ã€‚');
            });

            // --- Data Import ---
            document.getElementById('btn-import').addEventListener('click', () => {
                const json = document.getElementById('io-area').value;
                if (!json.trim()) {
                    alert('ã‚¨ãƒªã‚¢ãŒç©ºã§ã™ã€‚ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚');
                    return;
                }

                try {
                    const data = JSON.parse(json);
                    let count = 0;

                    rows.forEach(row => {
                        const date = row.cells[0].innerText.trim();
                        if (data[date]) {
                            // 1. Restore Breakfast
                            const bkInput = row.querySelector('.check-bk');
                            const bkState = data[date].bk;
                            bkInput.checked = bkState;

                            // Visual toggle
                            const bkBtn = bkInput.parentElement;
                            if (bkState) bkBtn.classList.add('active');
                            else bkBtn.classList.remove('active');

                            // 2. Restore Night Items
                            const nightInputs = row.querySelectorAll('.night-item-check');
                            const nightStates = data[date].night;

                            if (Array.isArray(nightStates)) {
                                nightInputs.forEach((input, idx) => {
                                    if (nightStates[idx] !== undefined) {
                                        input.checked = nightStates[idx];

                                        // Visual toggle
                                        const lbl = input.parentElement;
                                        if (input.checked) {
                                            lbl.classList.remove('unchecked');
                                            lbl.classList.add('checked');
                                        } else {
                                            lbl.classList.remove('checked');
                                            lbl.classList.add('unchecked');
                                        }
                                    }
                                });
                            }

                            // 3. Recalculate
                            updateRow(row);
                            count++;
                        }
                    });

                    alert(`${count}æ—¥åˆ†ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¾ã—ãŸã€‚`);

                } catch (e) {
                    console.error(e);
                    alert('ã‚¨ãƒ©ãƒ¼ï¼šãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ããªã„ã‚ˆã†ã§ã™ã€‚');
                }
            });
        });
    </script>
</body>

</html>