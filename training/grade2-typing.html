<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°å­¦2å¹´ç”Ÿ æ¼¢å­—ç·´ç¿’</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel CDN for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const KanjiPracticeApp = () => {
          // å°å­¦2å¹´ç”Ÿã®æ¼¢å­—ãƒ‡ãƒ¼ã‚¿ï¼ˆä¸€éƒ¨æŠœç²‹ï¼‰
          const kanjiData = [
            { kanji: 'æ°´', onyomi: ['ã‚¹ã‚¤'], kunyomi: ['ã¿ãš'], meaning: 'æ°´' },
            { kanji: 'ç«', onyomi: ['ã‚«'], kunyomi: ['ã²'], meaning: 'ç«' },
            { kanji: 'æœ¨', onyomi: ['ãƒ¢ã‚¯', 'ãƒœã‚¯'], kunyomi: ['ã'], meaning: 'æœ¨' },
            { kanji: 'é‡‘', onyomi: ['ã‚­ãƒ³'], kunyomi: ['ã‹ã­'], meaning: 'é‡‘' },
            { kanji: 'åœŸ', onyomi: ['ãƒ‰', 'ãƒˆ'], kunyomi: ['ã¤ã¡'], meaning: 'åœŸ' },
            { kanji: 'æ—¥', onyomi: ['ãƒ‹ãƒ', 'ã‚¸ãƒ„'], kunyomi: ['ã²', 'ã‹'], meaning: 'æ—¥' },
            { kanji: 'æœˆ', onyomi: ['ã‚²ãƒ„', 'ã‚¬ãƒ„'], kunyomi: ['ã¤ã'], meaning: 'æœˆ' },
            { kanji: 'å¹´', onyomi: ['ãƒãƒ³'], kunyomi: ['ã¨ã—'], meaning: 'å¹´' },
            { kanji: 'æ™‚', onyomi: ['ã‚¸'], kunyomi: ['ã¨ã'], meaning: 'æ™‚é–“' },
            { kanji: 'é–“', onyomi: ['ã‚«ãƒ³', 'ã‚±ãƒ³'], kunyomi: ['ã‚ã„ã ', 'ã¾'], meaning: 'é–“' },
            { kanji: 'åˆ†', onyomi: ['ãƒ–ãƒ³', 'ãƒ•ãƒ³'], kunyomi: ['ã‚-ã‘ã‚‹'], meaning: 'åˆ†ã‘ã‚‹' },
            { kanji: 'åŠ', onyomi: ['ãƒãƒ³'], kunyomi: ['ãªã‹-ã°'], meaning: 'åŠåˆ†' },
            { kanji: 'æ–¹', onyomi: ['ãƒ›ã‚¦'], kunyomi: ['ã‹ãŸ'], meaning: 'æ–¹å‘' },
            { kanji: 'åŒ—', onyomi: ['ãƒ›ã‚¯'], kunyomi: ['ããŸ'], meaning: 'åŒ—' },
            { kanji: 'å—', onyomi: ['ãƒŠãƒ³'], kunyomi: ['ã¿ãªã¿'], meaning: 'å—' },
            { kanji: 'æ±', onyomi: ['ãƒˆã‚¦'], kunyomi: ['ã²ãŒã—'], meaning: 'æ±' },
            { kanji: 'è¥¿', onyomi: ['ã‚»ã‚¤', 'ã‚µã‚¤'], kunyomi: ['ã«ã—'], meaning: 'è¥¿' },
            { kanji: 'é•·', onyomi: ['ãƒãƒ§ã‚¦'], kunyomi: ['ãªãŒ-ã„'], meaning: 'é•·ã„' },
            { onyomi: ['ã‚³ã‚¦'], kunyomi: ['ãŸã‹-ã„'], meaning: 'é«˜ã„' },
            { kanji: 'æ–°', onyomi: ['ã‚·ãƒ³'], kunyomi: ['ã‚ãŸã‚‰-ã—ã„'], meaning: 'æ–°ã—ã„' }
          ];

          const [currentKanji, setCurrentKanji] = useState(null);
          const [questionType, setQuestionType] = useState('onyomi');
          const [questionHistory, setQuestionHistory] = useState([]); // å‡ºé¡Œå±¥æ­´ã‚’è¿½è·¡
          const [options, setOptions] = useState([]);
          const [selectedAnswer, setSelectedAnswer] = useState(null);
          const [showResult, setShowResult] = useState(false);
          const [score, setScore] = useState(0);
          const [totalQuestions, setTotalQuestions] = useState(0);
          const [gameStarted, setGameStarted] = useState(false);
          const [reviewMode, setReviewMode] = useState(false);
          const [reviewKanji, setReviewKanji] = useState([]);
          const [nextReviewTime, setNextReviewTime] = useState(null);
          const [timeUntilReview, setTimeUntilReview] = useState(0);
          const [studiedKanji, setStudiedKanji] = useState([]);

          // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ é–¢é€£ã®çŠ¶æ…‹
          const [showTypingGame, setShowTypingGame] = useState(false);
          const [typingInput, setTypingInput] = useState('');
          const [typingTarget, setTypingTarget] = useState('');
          const [typingQuestionType, setTypingQuestionType] = useState('onyomi');
          const [typingResult, setTypingResult] = useState(null);
          const [typingScore, setTypingScore] = useState(0);
          const [totalTypingQuestions, setTotalTypingQuestions] = useState(0);

          // å‡ºé¡Œã‚¿ã‚¤ãƒ—ã‚’æ±ºå®šã™ã‚‹é–¢æ•°ï¼ˆ2-3å•ã”ã¨ã«åˆ‡ã‚Šæ›¿ãˆï¼‰
          const determineQuestionType = () => {
            const recentHistory = questionHistory.slice(-3); // ç›´è¿‘3å•ã®å±¥æ­´
            const lastType = recentHistory.length > 0 ? recentHistory[recentHistory.length - 1] : null;
            
            // åŒã˜ã‚¿ã‚¤ãƒ—ãŒ2-3å•é€£ç¶šã—ãŸã‚‰åˆ‡ã‚Šæ›¿ãˆ
            const sameTypeCount = recentHistory.reverse().findIndex(type => type !== lastType);
            const consecutiveCount = sameTypeCount === -1 ? recentHistory.length : sameTypeCount;
            
            if (consecutiveCount >= 2 && Math.random() > 0.3) {
              // 2å•ä»¥ä¸Šé€£ç¶šã§70%ã®ç¢ºç‡ã§åˆ‡ã‚Šæ›¿ãˆ
              return lastType === 'onyomi' ? 'kunyomi' : 'onyomi';
            } else if (consecutiveCount >= 3) {
              // 3å•é€£ç¶šãªã‚‰å¿…ãšåˆ‡ã‚Šæ›¿ãˆ
              return lastType === 'onyomi' ? 'kunyomi' : 'onyomi';
            } else {
              // ãƒ©ãƒ³ãƒ€ãƒ ã«æ±ºå®š
              return Math.random() < 0.5 ? 'onyomi' : 'kunyomi';
            }
          };

          // 5åˆ†é–“éš”å¾©ç¿’ã‚¿ã‚¤ãƒãƒ¼
          useEffect(() => {
            let timer;
            
            if (gameStarted && !reviewMode && studiedKanji.length > 0) {
              timer = setInterval(() => {
                const now = Date.now();
                if (nextReviewTime && now >= nextReviewTime) {
                  startReviewTest();
                } else if (nextReviewTime) {
                  setTimeUntilReview(Math.max(0, Math.ceil((nextReviewTime - now) / 1000)));
                }
              }, 1000);
            }

            return () => {
              if (timer) clearInterval(timer);
            };
          }, [gameStarted, reviewMode, nextReviewTime, studiedKanji]);

          // å¾©ç¿’ãƒ†ã‚¹ãƒˆã‚’é–‹å§‹
          const startReviewTest = () => {
            if (studiedKanji.length === 0) return;
            
            const shuffledKanji = [...studiedKanji].sort(() => Math.random() - 0.5);
            const reviewSelection = shuffledKanji.slice(0, Math.min(5, shuffledKanji.length));
            
            setReviewKanji(reviewSelection);
            setReviewMode(true);
            setNextReviewTime(null);
            setTimeUntilReview(0);
            
            generateReviewQuestion(reviewSelection);
          };

          // å¾©ç¿’ãƒ†ã‚¹ãƒˆç”¨å•é¡Œç”Ÿæˆ
          const generateReviewQuestion = (kanjiList = reviewKanji) => {
            if (kanjiList.length === 0) return;
            
            const randomKanji = kanjiList[Math.floor(Math.random() * kanjiList.length)];
            const questionType = determineQuestionType();
            
            setCurrentKanji(randomKanji);
            setQuestionType(questionType);
            setQuestionHistory(prev => [...prev, questionType]);
            setSelectedAnswer(null);
            setShowResult(false);

            const correctAnswers = questionType === 'onyomi' ? randomKanji.onyomi : randomKanji.kunyomi;
            const correctAnswer = correctAnswers[Math.floor(Math.random() * correctAnswers.length)];
            
            const wrongOptions = [];
            const otherKanji = kanjiList.filter(k => k.kanji !== randomKanji.kanji);
            
            while (wrongOptions.length < 3 && otherKanji.length > 0) {
              const randomOther = otherKanji[Math.floor(Math.random() * otherKanji.length)];
              const wrongAnswer = questionType === 'onyomi' 
                ? randomOther.onyomi[Math.floor(Math.random() * randomOther.onyomi.length)]
                : randomOther.kunyomi[Math.floor(Math.random() * randomOther.kunyomi.length)];
              
              if (!wrongOptions.includes(wrongAnswer) && wrongAnswer !== correctAnswer) {
                wrongOptions.push(wrongAnswer);
              }
            }

            while (wrongOptions.length < 3) {
              const randomOther = kanjiData[Math.floor(Math.random() * kanjiData.length)];
              if (randomOther.kanji === randomKanji.kanji) continue;
              
              const wrongAnswer = questionType === 'onyomi' 
                ? randomOther.onyomi[Math.floor(Math.random() * randomOther.onyomi.length)]
                : randomOther.kunyomi[Math.floor(Math.random() * randomOther.kunyomi.length)];
              
              if (!wrongOptions.includes(wrongAnswer) && wrongAnswer !== correctAnswer) {
                wrongOptions.push(wrongAnswer);
              }
            }

            const allOptions = [correctAnswer, ...wrongOptions].sort(() => Math.random() - 0.5);
            setOptions(allOptions.map(option => ({
              text: option,
              isCorrect: option === correctAnswer
            })));
          };

          // æ–°ã—ã„å•é¡Œã‚’ç”Ÿæˆ
          const generateQuestion = () => {
            if (reviewMode) {
              generateReviewQuestion();
              return;
            }
            
            const randomKanji = kanjiData[Math.floor(Math.random() * kanjiData.length)];
            const questionType = determineQuestionType();
            
            setCurrentKanji(randomKanji);
            setQuestionType(questionType);
            setQuestionHistory(prev => [...prev, questionType]);
            setSelectedAnswer(null);
            setShowResult(false);

            setStudiedKanji(prev => {
              if (!prev.find(k => k.kanji === randomKanji.kanji)) {
                const newStudied = [...prev, randomKanji];
                
                if (newStudied.length === 1) {
                  const reviewTime = Date.now() + 5 * 60 * 1000;
                  setNextReviewTime(reviewTime);
                }
                
                return newStudied;
              }
              return prev;
            });

            const correctAnswers = questionType === 'onyomi' ? randomKanji.onyomi : randomKanji.kunyomi;
            const correctAnswer = correctAnswers[Math.floor(Math.random() * correctAnswers.length)];
            
            const wrongOptions = [];
            const otherKanji = kanjiData.filter(k => k.kanji !== randomKanji.kanji);
            
            while (wrongOptions.length < 3) {
              const randomOther = otherKanji[Math.floor(Math.random() * otherKanji.length)];
              const wrongAnswer = questionType === 'onyomi' 
                ? randomOther.onyomi[Math.floor(Math.random() * randomOther.onyomi.length)]
                : randomOther.kunyomi[Math.floor(Math.random() * randomOther.kunyomi.length)];
              
              if (!wrongOptions.includes(wrongAnswer) && wrongAnswer !== correctAnswer) {
                wrongOptions.push(wrongAnswer);
              }
            }

            const allOptions = [correctAnswer, ...wrongOptions].sort(() => Math.random() - 0.5);
            setOptions(allOptions.map(option => ({
              text: option,
              isCorrect: option === correctAnswer
            })));
          };

          // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹
          const startTypingGame = () => {
            if (!currentKanji) return;
            
            // ãƒ©ãƒ³ãƒ€ãƒ ã«éŸ³èª­ã¿ãƒ»è¨“èª­ã¿ã‚’é¸æŠ
            const typingType = Math.random() < 0.5 ? 'onyomi' : 'kunyomi';
            const targetReadings = typingType === 'onyomi' ? currentKanji.onyomi : currentKanji.kunyomi;
            const target = targetReadings[Math.floor(Math.random() * targetReadings.length)];
            
            setTypingQuestionType(typingType);
            setTypingTarget(target);
            setTypingInput('');
            setTypingResult(null);
            setShowTypingGame(true);
          };

          // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã®ç­”ãˆã‚’ãƒã‚§ãƒƒã‚¯
          const checkTypingAnswer = () => {
            const isCorrect = typingInput.trim() === typingTarget;
            setTypingResult(isCorrect);
            setTotalTypingQuestions(prev => prev + 1);
            
            if (isCorrect) {
              setTypingScore(prev => prev + 1);
              playSound(true);
            } else {
              playSound(false);
            }
          };

          // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ã‚’çµ‚äº†
          const closeTypingGame = () => {
            setShowTypingGame(false);
            setTypingInput('');
            setTypingResult(null);
          };

          // åŠ¹æœéŸ³ã‚’å†ç”Ÿ
          const playSound = (isCorrect) => {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            if (isCorrect) {
              const frequencies = [523.25, 659.25];
              frequencies.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime + index * 0.1);
                oscillator.stop(audioContext.currentTime + 0.5);
              });
            } else {
              const oscillator = audioContext.createOscillator();
              const gainNode = audioContext.createGain();
              
              oscillator.connect(gainNode);
              gainNode.connect(audioContext.destination);
              
              oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
              oscillator.type = 'sawtooth';
              
              gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
              gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
              
              oscillator.start();
              oscillator.stop(audioContext.currentTime + 1);
            }
          };

          // éŸ³å£°èª­ã¿ä¸Šã’
          const speakAnswer = (kanji, onyomi, kunyomi) => {
            if ('speechSynthesis' in window) {
              speechSynthesis.cancel();
              
              const utterance = new SpeechSynthesisUtterance();
              const text = `ç­”ãˆã¯ã€éŸ³èª­ã¿${onyomi.join('ã€')}ã€è¨“èª­ã¿${kunyomi.join('ã€')}ã§ã™ã€‚`;
              utterance.text = text;
              utterance.lang = 'ja-JP';
              utterance.rate = 0.8;
              utterance.pitch = 1;
              
              speechSynthesis.speak(utterance);
            }
          };

          const speakAnswerManually = () => {
            if (currentKanji) {
              speakAnswer(currentKanji.kanji, currentKanji.onyomi, currentKanji.kunyomi);
            }
          };

          // ç­”ãˆã‚’é¸æŠ
          const selectAnswer = (option) => {
            if (showResult) return;
            
            setSelectedAnswer(option);
            setShowResult(true);
            setTotalQuestions(prev => prev + 1);
            
            playSound(option.isCorrect);
            
            if (option.isCorrect) {
              setScore(prev => prev + 1);
            }

            setTimeout(() => {
              speakAnswer(currentKanji.kanji, currentKanji.onyomi, currentKanji.kunyomi);
            }, 1000);
          };

          // æ¬¡ã®å•é¡Œã¸
          const nextQuestion = () => {
            if (reviewMode) {
              if (reviewKanji.length > 0) {
                generateReviewQuestion();
              } else {
                setReviewMode(false);
                const nextTime = Date.now() + 5 * 60 * 1000;
                setNextReviewTime(nextTime);
                generateQuestion();
              }
            } else {
              generateQuestion();
            }
          };

          const exitReviewMode = () => {
            setReviewMode(false);
            setReviewKanji([]);
            const nextTime = Date.now() + 5 * 60 * 1000;
            setNextReviewTime(nextTime);
            generateQuestion();
          };

          const startGame = () => {
            setGameStarted(true);
            setScore(0);
            setTotalQuestions(0);
            setTypingScore(0);
            setTotalTypingQuestions(0);
            setQuestionHistory([]);
            generateQuestion();
          };

          const resetGame = () => {
            setGameStarted(false);
            setCurrentKanji(null);
            setScore(0);
            setTotalQuestions(0);
            setTypingScore(0);
            setTotalTypingQuestions(0);
            setReviewMode(false);
            setReviewKanji([]);
            setStudiedKanji([]);
            setNextReviewTime(null);
            setTimeUntilReview(0);
            setQuestionHistory([]);
            setShowTypingGame(false);
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
              <div className="max-w-2xl mx-auto">
                {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
                <div className="text-center mb-8">
                  <h1 className="text-3xl font-bold text-indigo-800 mb-2 flex items-center justify-center gap-2">
                    <span>{'ğŸ“–'}</span>
                    å°å­¦2å¹´ç”Ÿ æ¼¢å­—ç·´ç¿’
                  </h1>
                  <p className="text-gray-600">éŸ³èª­ã¿ãƒ»è¨“èª­ã¿ã‚’è¦šãˆã‚ˆã†ï¼</p>
                </div>

                {/* ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ« */}
                {showTypingGame && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-xl shadow-xl p-6 w-full max-w-md">
                      <div className="text-center mb-6">
                        <div className="flex items-center justify-center gap-2 mb-4">
                          <span>{'âŒ¨ï¸'}</span>
                          <h3 className="text-xl font-bold text-gray-800">ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
                        </div>
                        <div className="text-4xl font-bold text-purple-800 mb-2">
                          {currentKanji?.kanji}
                        </div>
                        <p className="text-gray-600 mb-4">
                          ã“ã®æ¼¢å­—ã®<span className="font-semibold text-purple-600">
                            {typingQuestionType === 'onyomi' ? 'éŸ³èª­ã¿' : 'è¨“èª­ã¿'}
                          </span>ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                        </p>
                      </div>

                      <div className="mb-4">
                        <input
                          type="text"
                          value={typingInput}
                          onChange={(e) => setTypingInput(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && !typingResult && checkTypingAnswer()}
                          className="w-full p-3 border-2 border-gray-300 rounded-lg text-center text-lg font-medium focus:border-purple-500 focus:outline-none"
                          placeholder="èª­ã¿æ–¹ã‚’å…¥åŠ›..."
                          disabled={typingResult !== null}
                          autoFocus
                        />
                      </div>

                      {typingResult !== null ? (
                        <div className="text-center">
                          <div className={`text-lg font-semibold mb-3 ${
                            typingResult ? 'text-green-600' : 'text-red-600'
                          }`}>
                            {typingResult ? 'æ­£è§£ã§ã™ï¼' : 'ä¸æ­£è§£ã§ã™...'}
                          </div>
                          <div className="bg-gray-50 rounded-lg p-3 mb-4 text-sm">
                            <p className="font-semibold text-gray-800 mb-1">æ­£è§£:</p>
                            <p className="text-lg font-medium text-purple-600">{typingTarget}</p>
                          </div>
                          <button
                            onClick={closeTypingGame}
                            className="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-6 rounded-lg transition-colors"
                          >
                            æˆ»ã‚‹
                          </button>
                        </div>
                      ) : (
                        <div className="flex gap-2">
                          <button
                            onClick={checkTypingAnswer}
                            className="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-4 rounded-lg transition-colors"
                            disabled={!typingInput.trim()}
                          >
                            ç­”ãˆã‚‹
                          </button>
                          <button
                            onClick={closeTypingGame}
                            className="bg-gray-500 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-colors"
                          >
                            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {!gameStarted ? (
                  /* ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ */
                  <div className="bg-white rounded-xl shadow-lg p-8 text-center">
                    <div className="mb-6">
                      <div className="text-6xl mb-4"></div>
                      <h2 className="text-2xl font-semibold text-gray-800 mb-2">
                        æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç·´ç¿’ã—ã¾ã—ã‚‡ã†ï¼
                      </h2>
                      <p className="text-gray-600 mb-2">
                        éŸ³èª­ã¿ã¨è¨“èª­ã¿ã®å•é¡ŒãŒå‡ºé¡Œã•ã‚Œã¾ã™
                      </p>
                      <p className="text-sm text-gray-500">
                        2-3å•ã”ã¨ã«å‡ºé¡Œã‚¿ã‚¤ãƒ—ãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™
                      </p>
                    </div>
                    <button
                      onClick={startGame}
                      className="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-8 rounded-lg text-lg transition-colors"
                    >
                      ç·´ç¿’ã‚’å§‹ã‚ã‚‹
                    </button>
                  </div>
                ) : (
                  <div className="space-y-6">
                    {/* ã‚¹ã‚³ã‚¢è¡¨ç¤º */}
                    <div className="bg-white rounded-xl shadow-lg p-4">
                      <div className="flex justify-between items-center">
                        <div className="flex items-center gap-4">
                          <div className="flex items-center gap-2">
                            <span>{'â­'}</span>
                            <span className="font-semibold">
                              é¸æŠ: {score}/{totalQuestions}
                            </span>
                          </div>
                          <div className="flex items-center gap-2">
                            <span>{'âŒ¨ï¸'}</span>
                            <span className="font-semibold">
                              ã‚¿ã‚¤ãƒ”ãƒ³ã‚°: {typingScore}/{totalTypingQuestions}
                            </span>
                          </div>
                          
                          {reviewMode ? (
                            <div className="flex items-center gap-2 bg-orange-100 px-3 py-1 rounded-full">
                              <span>{'ğŸ”'}</span>
                              <span className="text-sm text-orange-700 font-medium">å¾©ç¿’ãƒ¢ãƒ¼ãƒ‰</span>
                            </div>
                          ) : (
                            studiedKanji.length > 0 && timeUntilReview > 0 && (
                              <div className="flex items-center gap-2 bg-blue-100 px-3 py-1 rounded-full">
                                <span>{'â°'}</span>
                                <span className="text-sm text-blue-700">
                                  å¾©ç¿’ã¾ã§ {Math.floor(timeUntilReview / 60)}:{(timeUntilReview % 60).toString().padStart(2, '0')}
                                </span>
                              </div>
                            )
                          )}
                        </div>
                        
                        <div className="flex items-center gap-2">
                          {reviewMode && (
                            <button
                              onClick={exitReviewMode}
                              className="text-sm bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded transition-colors"
                            >
                              å¾©ç¿’çµ‚äº†
                            </button>
                          )}
                          <button
                            onClick={resetGame}
                            className="flex items-center gap-1 text-gray-600 hover:text-gray-800 transition-colors"
                          >
                            {'ğŸ”„'}
                            ãƒªã‚»ãƒƒãƒˆ
                          </button>
                        </div>
                      </div>
                      
                      {studiedKanji.length > 0 && (
                        <div className="mt-3 pt-3 border-t border-gray-200">
                          <div className="flex justify-between items-center text-sm text-gray-600">
                            <span>å­¦ç¿’æ¸ˆã¿æ¼¢å­—: {studiedKanji.length}å€‹</span>
                            {!reviewMode && studiedKanji.length >= 1 && (
                              <button
                                onClick={startReviewTest}
                                className="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-xs transition-colors"
                              >
                                å¾©ç¿’é–‹å§‹
                              </button>
                            )}
                          </div>
                        </div>
                      )}
                    </div>

                    {/* å•é¡Œè¡¨ç¤º */}
                    {currentKanji && (
                      <div className="bg-white rounded-xl shadow-lg p-8">
                        <div className="text-center mb-6">
                          <div className="text-8xl font-bold text-indigo-800 mb-4">
                            {currentKanji.kanji}
                          </div>
                          {reviewMode && (
                            <div className="bg-orange-100 border border-orange-300 rounded-lg p-2 mb-4">
                              <p className="text-orange-800 font-semibold text-sm">
                                 å¾©ç¿’ãƒ†ã‚¹ãƒˆä¸­ - å­¦ç¿’ã—ãŸæ¼¢å­—ã®ç¢ºèªã§ã™
                              </p>
                            </div>
                          )}
                          <p className="text-lg text-gray-700 mb-2">
                            ã“ã®æ¼¢å­—ã®
                            <span className="font-semibold text-indigo-600">
                              {questionType === 'onyomi' ? 'éŸ³èª­ã¿' : 'è¨“èª­ã¿'}
                            </span>
                            ã¯ï¼Ÿ
                          </p>
                          <p className="text-sm text-gray-500">
                            æ„å‘³: {currentKanji.meaning}
                          </p>
                        </div>

                        {/* é¸æŠè‚¢ */}
                        <div className="grid grid-cols-2 gap-4 mb-6">
                          {options.map((option, index) => (
                            <button
                              key={index}
                              onClick={() => selectAnswer(option)}
                              disabled={showResult}
                              className={`p-4 rounded-lg border-2 text-lg font-medium transition-all
                                ${showResult
                                  ? option.isCorrect
                                    ? 'bg-green-100 border-green-500 text-green-800'
                                    : selectedAnswer === option
                                    ? 'bg-red-100 border-red-500 text-red-800'
                                    : 'bg-gray-100 border-gray-300 text-gray-600'
                                  : 'bg-white border-gray-300 hover:border-indigo-400 hover:bg-indigo-50'
                                }`}
                            >
                              {option.text}
                              {showResult && option.isCorrect && (
                                <span>{'âœ…'}</span>
                              )}
                              {showResult && selectedAnswer === option && !option.isCorrect && (
                                <span>{'âŒ'}</span>
                              )}
                            </button>
                          ))}
                        </div>

                        {/* çµæœè¡¨ç¤º */}
                        {showResult && (
                          <div className="text-center">
                            <div className={`text-lg font-semibold mb-4 ${
                              selectedAnswer?.isCorrect ? 'text-green-600' : 'text-red-600'
                            }`}>
                              {selectedAnswer?.isCorrect ? 'æ­£è§£ã§ã™ï¼' : 'ä¸æ­£è§£ã§ã™...'}
                            </div>
                            
                            <div className="bg-gray-50 rounded-lg p-4 mb-4 text-sm">
                              <div className="flex items-center justify-between mb-2">
                                <p className="font-semibold text-gray-800">ç­”ãˆ:</p>
                                <button
                                  onClick={speakAnswerManually}
                                  className="flex items-center gap-1 bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md text-xs transition-colors"
                                  title="éŸ³å£°ã§èª­ã¿ä¸Šã’"
                                >
                                  {'ğŸ”Š'}
                                  èª­ã¿ä¸Šã’
                                </button>
                              </div>
                              <p>éŸ³èª­ã¿: {currentKanji.onyomi.join('ã€')}</p>
                              <p>è¨“èª­ã¿: {currentKanji.kunyomi.join('ã€')}</p>
                            </div>

                            <div className="flex gap-3 justify-center">
                              <button
                                onClick={startTypingGame}
                                className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors"
                              >
                                {'âŒ¨ï¸'}
                                ã‚¿ã‚¤ãƒ”ãƒ³ã‚°
                              </button>
                              <button
                                onClick={nextQuestion}
                                className="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-6 rounded-lg transition-colors"
                              >
                                æ¬¡ã®å•é¡Œã¸
                              </button>
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<KanjiPracticeApp />);
    </script>
</body>
</html>