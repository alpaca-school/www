<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ï½œä½“é¨“ãƒ•ãƒ­ã‚¢ ğŸ¦™</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap');

    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      scrollbar-width: none;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const SHEET_ID = "1YXtuEzZHrV236tzNj7DfvdweXxAGZZNP8OVGJbujrrg";
    const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&gid=0`;

    const floorMeta = {
      æ­´å²: "éå»ã‚’çŸ¥ã‚Šã€ä»Šã‚’ç†è§£ã™ã‚‹", æ–‡åŒ–: "æ‰‹ä»•äº‹ã¨ç‰©èªã«è§¦ã‚Œã‚‹", è‡ªç„¶: "ç”Ÿãã¦ã„ã‚‹ç’°å¢ƒã‚’æ„Ÿã˜ã‚‹",
      å¹³å’Œ: "ç¤¾ä¼šã¨è‡ªåˆ†ã®é–¢ä¿‚ã‚’è€ƒãˆã‚‹", ç”Ÿæ´»: "æš®ã‚‰ã—ã®ä¸­ã§ç”Ÿãã‚‹åŠ›ã‚’è‚²ã¦ã‚‹", ç¤¾ä¼š: "ç¤¾ä¼šã¨é–¢ã‚ã‚‹æº–å‚™ã‚’ã™ã‚‹"
    };
    const floors = ["æ­´å²", "æ–‡åŒ–", "è‡ªç„¶", "å¹³å’Œ", "ç”Ÿæ´»", "ç¤¾ä¼š"];

    const initialFloorData = {
      æ­´å²: { title: "æ­´å²", color: "bg-pink-100 border-pink-300", headerColor: "bg-pink-200", sections: [] },
      æ–‡åŒ–: { title: "æ–‡åŒ–", color: "bg-green-100 border-green-300", headerColor: "bg-green-200", sections: [] },
      è‡ªç„¶: { title: "è‡ªç„¶", color: "bg-orange-100 border-orange-300", headerColor: "bg-orange-200", sections: [] },
      å¹³å’Œ: { title: "å¹³å’Œ", color: "bg-blue-100 border-blue-300", headerColor: "bg-blue-200", sections: [] },
      ç”Ÿæ´»: { title: "ç”Ÿæ´»", color: "bg-yellow-100 border-yellow-300", headerColor: "bg-yellow-200", sections: [] },
      ç¤¾ä¼š: { title: "ç¤¾ä¼š", color: "bg-cyan-100 border-cyan-300", headerColor: "bg-cyan-200", sections: [] }
    };

    function App() {
      const [currentFloor, setCurrentFloor] = useState("æ­´å²");
      const [videoUrl, setVideoUrl] = useState(null);
      const [modal, setModal] = useState(null);
      const [floorData, setFloorData] = useState(initialFloorData);
      const [debugInfo, setDebugInfo] = useState(null);

      useEffect(() => {
        Papa.parse(SHEET_CSV_URL + "&t=" + new Date().getTime(), {
          download: true,
          header: true,
          complete: function (results) {
            const fetchedData = results.data;
            if (!fetchedData || fetchedData.length === 0) return;

            const newFloorData = JSON.parse(JSON.stringify(initialFloorData));
            const ignoredFloors = new Set();

            fetchedData.forEach((item, index) => {
              // åˆ—åã®ã‚†ã‚‰ãã‚’å¸åï¼ˆæ—¥æœ¬èªã§ã‚‚è‹±èªã§ã‚‚å‹•ãã‚ˆã†ã«ï¼‰
              const f = (item.floor || item.ãƒ•ãƒ­ã‚¢ || "").toString().trim();
              const t = (item.title || item.ã‚¿ã‚¤ãƒˆãƒ« || "").toString().trim();
              const d = (item.description || item.èª¬æ˜ || "").toString().trim();
              const type = (item.type || item.ã‚¿ã‚¤ãƒ— || "").toString().trim();
              const url = (item.url || "").toString().trim();
              const cs = (item.coming_soon || item.ã‚«ãƒŸãƒ³ã‚°ã‚¹ãƒ¼ãƒ³ || "").toString().toUpperCase().trim();

              if (!f || !t) return;

              if (!newFloorData[f]) {
                ignoredFloors.add(f);
                return;
              }

              const section = {
                id: item.id || `auto-${index}`,
                title: t,
                description: d,
                isComingSoon: cs === "TRUE"
              };

              if (type === "video") section.videoId = url;
              else if (type === "modal") {
                section.actionType = "modal";
                section.modalUrl = url;
              }

              newFloorData[f].sections.push(section);
            });

            setFloorData(newFloorData);
            if (ignoredFloors.size > 0) {
              setDebugInfo(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã€Œ${Array.from(ignoredFloors).join(", ")}ã€ã¨ã„ã†åå‰ã¯èªè­˜ã§ãã¾ã›ã‚“ã€‚ã€Œæ­´å²ã€æ–‡åŒ–ã€è‡ªç„¶ã€å¹³å’Œã€ç”Ÿæ´»ã€ç¤¾ä¼šã€ã®ã„ãšã‚Œã‹ã«æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚`);
            }
          }
        });
      }, []);

      const data = floorData[currentFloor];

      return (
        <div className="min-h-screen bg-gray-50 pb-20">
          <header className="bg-sky-100 p-8 text-center">
            <h1 className="text-4xl font-extrabold mb-2">ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ ğŸ¦™</h1>
            <p className="text-gray-700">å­ã©ã‚‚ã‹ã‚‰å¤§äººã¾ã§ã€å­¦ã³ãŒç¤¾ä¼šã«ã¤ãªãŒã‚‹ç¤¾ä¼šäººäºˆå‚™æ ¡</p>
          </header>

          {debugInfo && (
            <div className="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 max-w-4xl mx-auto mt-4 mx-4 shadow-sm">
              <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> {debugInfo}
            </div>
          )}

          <nav className={`${data.headerColor} sticky top-0 z-10 shadow-md p-4 transition-colors duration-500`}>
            <div className="max-w-4xl mx-auto">
              <h2 className="text-xl font-bold">{currentFloor}</h2>
              <p className="text-sm opacity-80 mb-3">{floorMeta[currentFloor]}</p>
              <div className="flex gap-2 overflow-x-auto no-scrollbar">
                {floors.map(f => (
                  <button key={f} onClick={() => setCurrentFloor(f)}
                    className={`px-4 py-2 rounded-lg font-bold whitespace-nowrap transition ${f === currentFloor ? "bg-white shadow" : "bg-white/40 hover:bg-white/60"}`}>
                    {f}
                  </button>
                ))}
              </div>
            </div>
          </nav>

          <main className="max-w-4xl mx-auto p-6 grid md:grid-cols-2 gap-6">
            {data.sections.length === 0 ? (
              <p className="col-span-full text-center py-20 text-gray-400">èª­ã¿è¾¼ã¿ä¸­ã€ã¾ãŸã¯ã“ã®ãƒ•ãƒ­ã‚¢ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ ğŸ¦™</p>
            ) : data.sections.map(s => (
              <div key={s.id} className={`${data.color} border-2 rounded-2xl p-6 shadow hover:shadow-lg transition-all`}>
                <h3 className="font-bold text-xl mb-3">{s.title}</h3>
                <p className="text-gray-700 mb-6 leading-relaxed whitespace-pre-wrap">{s.description}</p>
                <div className="flex gap-2">
                  {s.videoId && <button onClick={() => setVideoUrl(s.videoId)} className="bg-red-500 text-white px-4 py-2 rounded-full font-bold hover:bg-red-600 shadow-sm transition">å‹•ç”»ã‚’è¦‹ã‚‹</button>}
                  {s.actionType === "modal" && <button onClick={() => setModal(s)} className="bg-purple-600 text-white px-4 py-2 rounded-full font-bold hover:bg-purple-700 shadow-sm transition">å­¦ã¶</button>}
                  {s.isComingSoon && <button disabled className="bg-gray-300 text-gray-500 px-4 py-2 rounded-full font-bold cursor-not-allowed">Coming Soon</button>}
                </div>
              </div>
            ))}
          </main>

          {videoUrl && (
            <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setVideoUrl(null)}>
              <div className="relative w-full max-w-4xl aspect-video">
                <iframe src={`https://www.youtube.com/embed/${videoUrl}?autoplay=1`} className="w-full h-full rounded-xl" allow="autoplay" allowFullScreen />
              </div>
            </div>
          )}

          {modal && (
            <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setModal(null)}>
              <div className="relative w-full max-w-5xl h-[85vh] bg-white rounded-2xl overflow-hidden shadow-2xl" onClick={e => e.stopPropagation()}>
                <button onClick={() => setModal(null)} className="absolute top-4 right-4 bg-gray-100 hover:bg-gray-200 w-10 h-10 rounded-full font-bold z-10">âœ•</button>
                <iframe src={modal.modalUrl} className="w-full h-full border-none" />
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>

</html>