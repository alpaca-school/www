<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ï½œä½“é¨“ãƒ•ãƒ­ã‚¢ ğŸ¦™</title>
  <link rel="icon"
    href="https://lh6.googleusercontent.com/HUVxVFqoa_HrqwbO5sJ2JLzW8zY1A2HWxKXhjxrLsOG__vg47Yqrj85Vc1kSb9FxaFmxYM2tp2IBQ5r8mq0dh36txvYtg3hFfBowEr6rJiBaoG5bSmRmqYHmOA=w16383">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap');

    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }

    .text-fluid-4xl {
      font-size: clamp(2rem, 6vw, 3rem);
    }

    .text-fluid-xl {
      font-size: clamp(1.1rem, 3vw, 1.5rem);
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      scrollbar-width: none;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    /* ========= è¨­å®š ========= */
    const SHEET_ID = "1YXtuEzZHrV236tzNj7DfvdweXxAGZZNP8OVGJbujrrg";
    // ä¿®æ­£ï¼šCORSã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã—ã€ã‹ã¤idåˆ—ãŒãªãã¦ã‚‚ç›´æ¥å–å¾—ã§ãã‚‹URL
    const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=0`;

    /* ========= ãƒ•ãƒ­ã‚¢æ„å‘³ã¥ã‘ï¼ˆä½“é¨“ãƒ™ãƒ¼ã‚¹ï¼‰ ========= */
    const floorMeta = {
      æ­´å²: "éå»ã‚’çŸ¥ã‚Šã€ä»Šã‚’ç†è§£ã™ã‚‹",
      æ–‡åŒ–: "æ‰‹ä»•äº‹ã¨ç‰©èªã«è§¦ã‚Œã‚‹",
      è‡ªç„¶: "ç”Ÿãã¦ã„ã‚‹ç’°å¢ƒã‚’æ„Ÿã˜ã‚‹",
      å¹³å’Œ: "ç¤¾ä¼šã¨è‡ªåˆ†ã®é–¢ä¿‚ã‚’è€ƒãˆã‚‹",
      ç”Ÿæ´»: "æš®ã‚‰ã—ã®ä¸­ã§ç”Ÿãã‚‹åŠ›ã‚’è‚²ã¦ã‚‹",
      ç¤¾ä¼š: "ç¤¾ä¼šã¨é–¢ã‚ã‚‹æº–å‚™ã‚’ã™ã‚‹"
    };

    const floors = ["æ­´å²", "æ–‡åŒ–", "è‡ªç„¶", "å¹³å’Œ", "ç”Ÿæ´»", "ç¤¾ä¼š"];

    /* ========= åˆæœŸã®é™çš„ãƒ‡ãƒ¼ã‚¿æ§‹é€  ========= */
    const initialFloorData = {
      æ­´å²: { title: "æ­´å²", color: "bg-pink-100 border-pink-300", headerColor: "bg-pink-200", sections: [] },
      æ–‡åŒ–: { title: "æ–‡åŒ–", color: "bg-green-100 border-green-300", headerColor: "bg-green-200", sections: [] },
      è‡ªç„¶: { title: "è‡ªç„¶", color: "bg-orange-100 border-orange-300", headerColor: "bg-orange-200", sections: [] },
      å¹³å’Œ: { title: "å¹³å’Œ", color: "bg-blue-100 border-blue-300", headerColor: "bg-blue-200", sections: [] },
      ç”Ÿæ´»: { title: "ç”Ÿæ´»", color: "bg-yellow-100 border-yellow-300", headerColor: "bg-yellow-200", sections: [] },
      ç¤¾ä¼š: { title: "ç¤¾ä¼š", color: "bg-cyan-100 border-cyan-300", headerColor: "bg-cyan-200", sections: [] }
    };

    /* ========= Components ========= */
    const Hero = () => (
      <section className="bg-gradient-to-b from-sky-100 to-gray-50">
        <div className="max-w-4xl mx-auto p-8 text-center">
          <h1 className="text-fluid-4xl font-extrabold mb-4">ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ ğŸ¦™</h1>
          <p className="text-fluid-xl text-gray-700 leading-relaxed">
            å­ã©ã‚‚ã‹ã‚‰å¤§äººã¾ã§ã€<br />å­¦ã³ãŒç¤¾ä¼šã«ã¤ãªãŒã‚‹ç¤¾ä¼šäººäºˆå‚™æ ¡
          </p>
        </div>
      </section>
    );

    const Header = ({ currentFloor, setCurrentFloor, meta, data }) => (
      <header className={`${data.headerColor} sticky top-0 z-10 shadow transition-colors duration-300`}>
        <div className="max-w-4xl mx-auto p-4">
          <h2 className="text-xl font-extrabold">{currentFloor}</h2>
          <p className="text-sm text-gray-700">{meta}</p>
          <div className="flex gap-2 overflow-x-auto no-scrollbar mt-3">
            {floors.map(f => (
              <button key={f}
                onClick={() => setCurrentFloor(f)}
                className={`px-4 py-2 rounded-lg font-bold hover:bg-white transition whitespace-nowrap ${f === currentFloor ? "bg-white shadow-sm" : "bg-white/50"}`}>
                {f}
              </button>
            ))}
          </div>
        </div>
      </header>
    );

    const FloorContent = ({ data, onVideoClick, onModalClick, fetchError }) => (
      <main className="max-w-4xl mx-auto p-6">
        {fetchError && (
          <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
            <strong>ã‚¨ãƒ©ãƒ¼:</strong> {fetchError}
          </div>
        )}
        <div className="grid md:grid-cols-2 gap-4">
          {data.sections.length === 0 && !fetchError ? (
            <p className="col-span-full text-center py-20 text-gray-400">èª­ã¿è¾¼ã¿ä¸­ã€ã¾ãŸã¯ã“ã®ãƒ•ãƒ­ã‚¢ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ ğŸ¦™</p>
          ) : data.sections.map(s => (
            <div key={s.id} className={`${data.color} border-2 rounded-xl p-6 shadow hover:shadow-md transition`}>
              <h3 className="font-bold text-lg mb-2">{s.title}</h3>
              <p className="text-sm text-gray-700 mb-4 whitespace-pre-wrap">{s.description}</p>
              <div className="flex flex-wrap gap-2">
                {s.videoId && (
                  <button onClick={() => onVideoClick(s.videoId)}
                    className="bg-red-500 text-white px-3 py-2 rounded font-bold hover:bg-red-600 transition shadow-sm">
                    å‹•ç”»ã‚’è¦‹ã‚‹
                  </button>
                )}
                {s.actionType === "modal" && (
                  <button onClick={() => onModalClick(s)}
                    className="bg-purple-500 text-white px-3 py-2 rounded font-bold hover:bg-purple-600 transition shadow-sm">
                    å­¦ã¶
                  </button>
                )}
                {s.isComingSoon && (
                  <button disabled
                    className="bg-gray-300 text-gray-500 px-3 py-2 rounded font-bold cursor-not-allowed">
                    Coming Soon
                  </button>
                )}
              </div>
            </div>
          ))}
        </div>
      </main>
    );

    const Footer = () => (
      <>
        <section className="max-w-4xl mx-auto p-6">
          <div className="bg-white border-2 border-dashed rounded-xl p-6 text-center">
            <h3 className="font-bold text-lg mb-2">å­¦ã‚“ã ã“ã¨ã‚’ã€æ¬¡ã®ä¸€æ­©ã¸</h3>
            <p className="text-sm text-gray-600 mb-2">
              ä½“é¨“ã—ãŸã“ã¨ã¯ã€è¡¨ç¾ã‚’é€šã—ã¦ç¤¾ä¼šã¨ã¤ãªãŒã£ã¦ã„ãã¾ã™ã€‚
            </p>
            <a href="https://furima.ryukyu-tane.com"
              target="_blank" rel="noopener noreferrer"
              className="bg-emerald-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-emerald-600 transition inline-block shadow-sm">
              æ–‡èŠ¸ãƒ•ãƒªãƒã§è¡¨ç¾ã—ã¦ã¿ã‚‹
            </a>
          </div>
        </section >
        <footer className="bg-gray-800 text-white p-6 text-sm mt-10">
          <div className="max-w-4xl mx-auto">
            <p>
              ä»•äº‹ã¯ã€èª°ã‹ã¨ã®ã”ç¸ã€‚<br />ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ã¯ã€ãã®å…¥å£ã‚’ã¤ãã‚Šã¾ã™ã€‚<br />
              ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã€ã”è‡ªå®…ã‹ã‚‰å¿«é©ã«å­¦ç¿’ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚
            </p>
            <a href="./concept.html" className="inline-block mt-2 underline hover:text-emerald-300">
              â–¶ ã“ã®å­¦ã³ã®è¨­è¨ˆæ€æƒ³ã‚’èª­ã‚€
            </a>
          </div>
        </footer>
      </>
    );

    const VideoModal = ({ videoId, onClose }) => (
      <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={onClose}>
        <div className="relative w-full max-w-4xl">
          <button onClick={onClose} className="absolute -top-10 right-0 text-white font-bold">âœ• é–‰ã˜ã‚‹</button>
          <iframe src={`https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1&playsinline=1&autoplay=1`}
            className="w-full aspect-video rounded-lg shadow-2xl" allow="autoplay" allowFullScreen />
        </div>
      </div>
    );

    const ContentModal = ({ content, onClose }) => (
      <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={onClose}>
        <div className="relative w-full max-w-5xl h-[85vh]">
          <button onClick={onClose} className="absolute -top-10 right-0 text-white font-bold">âœ• é–‰ã˜ã‚‹</button>
          <iframe src={content.modalUrl} className="w-full h-full rounded-xl bg-white shadow-2xl" onClick={e => e.stopPropagation()} />
        </div>
      </div>
    );

    function App() {
      const [currentFloor, setCurrentFloor] = useState("æ­´å²");
      const [videoUrl, setVideoUrl] = useState(null);
      const [modal, setModal] = useState(null);
      const [floorData, setFloorData] = useState(initialFloorData);
      const [fetchError, setFetchError] = useState(null);
      const [debugInfo, setDebugInfo] = useState(null);

      useEffect(() => {
        const timestamp = new Date().getTime();
        const finalUrl = SHEET_CSV_URL + "&t=" + timestamp;

        Papa.parse(finalUrl, {
          download: true,
          header: true,
          skipEmptyLines: true,
          complete: function (results) {
            const fetchedData = results.data;
            if (!fetchedData || fetchedData.length === 0) {
              setFetchError("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚Webã«å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
              return;
            }

            const newFloorData = JSON.parse(JSON.stringify(initialFloorData));
            const ignoredFloors = new Set();

            fetchedData.forEach((item, index) => {
              const f = String(item.floor || item.ãƒ•ãƒ­ã‚¢ || "").trim();
              const t = String(item.title || item.ã‚¿ã‚¤ãƒˆãƒ« || "").trim();
              const d = item.description || item.èª¬æ˜ || "";
              const type = String(item.type || item.ã‚¿ã‚¤ãƒ— || "").trim();
              const url = String(item.url || "").trim();
              const cs = String(item.coming_soon || item.ã‚«ãƒŸãƒ³ã‚°ã‚¹ãƒ¼ãƒ³ || "").toUpperCase().trim();

              if (!f || !t) return;

              if (!newFloorData[f]) {
                ignoredFloors.add(f);
                return;
              }

              newFloorData[f].sections.push({
                id: item.id || `row-${index}`,
                title: t,
                description: d,
                videoId: type === "video" ? url : null,
                modalUrl: type === "modal" ? url : null,
                actionType: type === "modal" ? "modal" : null,
                isComingSoon: cs === "TRUE"
              });
            });

            setFloorData(newFloorData);
            setFetchError(null);
            setDebugInfo(ignoredFloors.size > 0 ? `ç„¡è¦–ã•ã‚ŒãŸãƒ•ãƒ­ã‚¢å: ${Array.from(ignoredFloors).join(", ")}` : null);
          },
          error: function (err) {
            console.error("PapaParse Error:", err);
            setFetchError("ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚Webã«å…¬é–‹ï¼ˆCSVå½¢å¼ï¼‰ã®è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
          }
        });
      }, []);

      useEffect(() => { lucide.createIcons(); }, [currentFloor, floorData]);

      const data = floorData[currentFloor];

      return (
        <div className="min-h-screen bg-gray-50">
          <Hero />
          {debugInfo && (
            <div className="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 p-4 max-w-4xl mx-auto mt-4 mx-4 text-sm rounded shadow-sm">
              <strong>ğŸ’¡ ç¢ºèªï¼š</strong> {debugInfo}
            </div>
          )}
          <Header currentFloor={currentFloor} setCurrentFloor={setCurrentFloor} meta={floorMeta[currentFloor]} data={data} />
          <FloorContent data={data} onVideoClick={setVideoUrl} onModalClick={setModal} fetchError={fetchError} />
          <Footer />
          {videoUrl && <VideoModal videoId={videoUrl} onClose={() => setVideoUrl(null)} />}
          {modal && <ContentModal content={modal} onClose={() => setModal(null)} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>

</html>