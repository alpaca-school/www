<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ï½œä½“é¨“ãƒ•ãƒ­ã‚¢ ğŸ¦™</title>
  <link rel="icon"
    href="https://lh6.googleusercontent.com/HUVxVFqoa_HrqwbO5sJ2JLzW8zY1A2HWxKXhjxrLsOG__vg47Yqrj85Vc1kSb9FxaFmxYM2tp2IBQ5r8mq0dh36txvYtg3hFfBowEr6rJiBaoG5bSmRmqYHmOA=w16383">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&display=swap');

    body {
      font-family: 'M PLUS Rounded 1c', sans-serif;
    }

    .text-fluid-4xl {
      font-size: clamp(2rem, 6vw, 3rem);
    }

    .text-fluid-xl {
      font-size: clamp(1.1rem, 3vw, 1.5rem);
    }

    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    .no-scrollbar {
      scrollbar-width: none;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    /* ========= è¨­å®š ========= */
    // Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€ãŸã‚ã®URL
    // CORSã‚¨ãƒ©ãƒ¼ã‚’å›é¿ã™ã‚‹ãŸã‚ã€åˆ¥ã®ãƒ—ãƒ­ã‚­ã‚·ã‚µãƒ¼ãƒ“ã‚¹(corsproxy.io)ã‚’çµŒç”±ã•ã›ã¾ã™
    // â€» æœ¬æ¥ã¯ã€Œãƒ•ã‚¡ã‚¤ãƒ«ã€â†’ã€Œå…±æœ‰ã€â†’ã€ŒWebã«å…¬é–‹ã€ã§ç™ºè¡Œã•ã‚ŒãŸURLã‚’ä½¿ã†ã®ãŒæœ€ã‚‚ç¢ºå®Ÿã§ã™
    const SHEET_ID = "1YXtuEzZHrV236tzNj7DfvdweXxAGZZNP8OVGJbujrrg";
    const TARGET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv`;
    const SHEET_CSV_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv&gid=0`;


    /* ========= ãƒ•ãƒ­ã‚¢æ„å‘³ã¥ã‘ï¼ˆä½“é¨“ãƒ™ãƒ¼ã‚¹ï¼‰ ========= */
    const floorMeta = {
      æ­´å²: "éå»ã‚’çŸ¥ã‚Šã€ä»Šã‚’ç†è§£ã™ã‚‹",
      æ–‡åŒ–: "æ‰‹ä»•äº‹ã¨ç‰©èªã«è§¦ã‚Œã‚‹",
      è‡ªç„¶: "ç”Ÿãã¦ã„ã‚‹ç’°å¢ƒã‚’æ„Ÿã˜ã‚‹",
      å¹³å’Œ: "ç¤¾ä¼šã¨è‡ªåˆ†ã®é–¢ä¿‚ã‚’è€ƒãˆã‚‹",
      ç”Ÿæ´»: "æš®ã‚‰ã—ã®ä¸­ã§ç”Ÿãã‚‹åŠ›ã‚’è‚²ã¦ã‚‹",
      ç¤¾ä¼š: "ç¤¾ä¼šã¨é–¢ã‚ã‚‹æº–å‚™ã‚’ã™ã‚‹"
    };

    const floors = ["æ­´å²", "æ–‡åŒ–", "è‡ªç„¶", "å¹³å’Œ", "ç”Ÿæ´»", "ç¤¾ä¼š"];

    /* ========= åˆæœŸã®é™çš„ãƒ‡ãƒ¼ã‚¿ ========= */
    const initialFloorData = {
      æ­´å²: {
        title: "æ­´å²", color: "bg-pink-100 border-pink-300", headerColor: "bg-pink-200",
        sections: [

        ]
      },
      æ–‡åŒ–: {
        title: "æ–‡åŒ–", color: "bg-green-100 border-green-300", headerColor: "bg-green-200",
        sections: [

        ]
      },
      è‡ªç„¶: {
        title: "è‡ªç„¶", color: "bg-orange-100 border-orange-300", headerColor: "bg-orange-200",
        sections: [
        ]
      },
      å¹³å’Œ: {
        title: "å¹³å’Œ", color: "bg-blue-100 border-blue-300", headerColor: "bg-blue-200",
        sections: [

        ]
      },
      ç”Ÿæ´»: {
        title: "ç”Ÿæ´»",
        color: "bg-yellow-100 border-yellow-300",
        headerColor: "bg-yellow-200",
        sections: [

        ]
      },
      ç¤¾ä¼š: {
        title: "ç¤¾ä¼š", color: "bg-cyan-100 border-cyan-300", headerColor: "bg-cyan-200",
        sections: [
        ]
      }
    };

    /* ========= Components ========= */

    const Hero = () => (
      <section className="bg-gradient-to-b from-sky-100 to-gray-50">
        <div className="max-w-4xl mx-auto p-8 text-center">
          <h1 className="text-fluid-4xl font-extrabold mb-4">ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ ğŸ¦™</h1>
          <p className="text-fluid-xl text-gray-700 leading-relaxed">
            å­ã©ã‚‚ã‹ã‚‰å¤§äººã¾ã§ã€<br />å­¦ã³ãŒç¤¾ä¼šã«ã¤ãªãŒã‚‹ç¤¾ä¼šäººäºˆå‚™æ ¡
          </p>
        </div>
      </section>
    );

    const Header = ({ currentFloor, setCurrentFloor, meta, data }) => (
      <header className={`${data.headerColor} sticky top-0 z-10 shadow`}>
        <div className="max-w-4xl mx-auto p-4">
          <h2 className="text-xl font-extrabold">{currentFloor}</h2>
          <p className="text-sm text-gray-700">{meta}</p>
          <div className="flex gap-2 overflow-x-auto no-scrollbar mt-3">
            {floors.map(f => (
              <button key={f}
                onClick={() => setCurrentFloor(f)}
                className={`px-4 py-2 rounded-lg font-bold hover:bg-white transition ${f === currentFloor ? "bg-white" : "bg-white/50"}`}>
                {f}
              </button>
            ))}
          </div>
        </div>
      </header>
    );

    const FloorContent = ({ data, onVideoClick, onModalClick }) => (
      <main className="max-w-4xl mx-auto p-6 grid md:grid-cols-2 gap-4">
        {data.sections.map(s => (
          <div key={s.id} className={`${data.color} border-2 rounded-xl p-6 shadow`}>
            <h3 className="font-bold text-lg mb-2">{s.title}</h3>
            <p className="text-sm text-gray-700 mb-4">{s.description}</p>
            {s.videoId && (
              <button onClick={() => onVideoClick(s.videoId)}
                className="bg-red-500 text-white px-3 py-2 rounded font-bold hover:bg-red-600 transition">
                å‹•ç”»ã‚’è¦‹ã‚‹
              </button>
            )}
            {(s.actionType === "modal" || s.learningContent) && (
              <button onClick={() => onModalClick(s)}
                className="bg-purple-500 text-white px-3 py-2 rounded font-bold ml-2 hover:bg-purple-600 transition">
                å­¦ã¶
              </button>
            )}
            {s.isComingSoon && (
              <button disabled
                className="bg-gray-300 text-gray-500 px-3 py-2 rounded font-bold ml-2 cursor-not-allowed">
                Coming Soon
              </button>
            )}
          </div>
        ))}
      </main>
    );

    const Footer = () => (
      <>
        <section className="max-w-4xl mx-auto p-6">
          <div className="bg-white border-2 border-dashed rounded-xl p-6 text-center">
            <h3 className="font-bold text-lg mb-2">å­¦ã‚“ã ã“ã¨ã‚’ã€æ¬¡ã®ä¸€æ­©ã¸</h3>
            <p className="text-sm text-gray-600 mb-2">
              ä½“é¨“ã—ãŸã“ã¨ã¯ã€è¡¨ç¾ã‚’é€šã—ã¦ç¤¾ä¼šã¨ã¤ãªãŒã£ã¦ã„ãã¾ã™ã€‚
            </p>
            <a href="https://furima.ryukyu-tane.com"
              target="_blank"
              rel="noopener noreferrer"
              className="bg-emerald-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-emerald-600 transition inline-block">
              æ–‡èŠ¸ãƒ•ãƒªãƒã§è¡¨ç¾ã—ã¦ã¿ã‚‹
            </a>
          </div>
        </section >

        <section className="max-w-4xl mx-auto p-6">
          <div className="bg-white border-2 border-dashed border-gray-200 rounded-xl p-8 text-center">
            <p className="mb-4 text-gray-700">
              å­¦ã³ã®ä¸­ã§ä½¿ã£ãŸæ•™æã‚„è¨˜éŒ²ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚
            </p>
            <a href="https://universe.tea-under.club/"
              className="inline-block px-6 py-2 bg-blue-50 text-blue-900 rounded-full font-bold hover:bg-blue-100 transition">
              ã¦ãƒã‚ã‚“ã ãã‚¯ãƒ©ãƒ– universe
            </a>
          </div>
        </section>

        <footer className="bg-gray-800 text-white p-6 text-sm">
          <div className="max-w-4xl mx-auto">
            <p>
              ä»•äº‹ã¯ã€èª°ã‹ã¨ã®ã”ç¸ã€‚<br />
              ã‚¢ãƒ«ãƒ‘ã‚«ã™ãã€œã‚‹ã¯ã€ãã®å…¥å£ã‚’ã¤ãã‚Šã¾ã™ã€‚
              <br />
              ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ã€ã”è‡ªå®…ã‹ã‚‰å¿«é©ã«å­¦ç¿’ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚è»Šæ¤…å­ã‚’ã”åˆ©ç”¨ã®æ–¹ã€é«˜é½¢ã®æ–¹ã€å¤–å‡ºãŒé›£ã—ã„æ–¹ãªã©ã€ã™ã¹ã¦ã®æ–¹ãŒæ¥½ã—ã‚ã‚‹ã‚ˆã†å–„å‡¦ã—ã¾ã™ã€‚
            </p>
            <a
              href="./concept.html"
              className="inline-block mt-2 underline hover:text-emerald-300"
            >
              â–¶ ã“ã®å­¦ã³ã®è¨­è¨ˆæ€æƒ³ã‚’èª­ã‚€
            </a>
          </div>
        </footer>
      </>
    );

    const VideoModal = ({ videoId, onClose }) => (
      <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={onClose}>
        <div className="relative w-full max-w-4xl">
          <button
            onClick={onClose}
            className="absolute -top-10 right-0 text-white hover:text-gray-300 text-sm font-bold"
            aria-label="é–‰ã˜ã‚‹">
            âœ• é–‰ã˜ã‚‹ (ESC)
          </button>
          <iframe
            key={videoId}
            src={`https://www.youtube.com/embed/${videoId}?rel=0&modestbranding=1&playsinline=1`}
            title="YouTube video player"
            className="w-full aspect-video rounded-lg"
            onClick={(e) => e.stopPropagation()}
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            referrerPolicy="strict-origin-when-cross-origin"
            allowFullScreen
          />
        </div>
      </div>
    );

    const ContentModal = ({ content, onClose }) => (
      <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4" onClick={onClose}>
        <div className="relative w-full max-w-4xl h-5/6">
          <button
            onClick={onClose}
            className="absolute -top-10 right-0 text-white hover:text-gray-300 text-sm font-bold"
            aria-label="é–‰ã˜ã‚‹">
            âœ• é–‰ã˜ã‚‹ (ESC)
          </button>
          {content.modalUrl ? (
            <iframe
              src={content.modalUrl}
              className="w-full h-full rounded-lg bg-white"
              onClick={(e) => e.stopPropagation()}
            />
          ) : content.learningContent ? (
            <div
              className="w-full h-full rounded-lg bg-white p-8 overflow-y-auto"
              onClick={(e) => e.stopPropagation()}>
              <h3 className="text-2xl font-bold mb-4">{content.learningContent.title}</h3>
              <div dangerouslySetInnerHTML={{ __html: content.learningContent.html }} />
            </div>
          ) : null}
        </div>
      </div>
    );

    function App() {
      const [currentFloor, setCurrentFloor] = useState("æ­´å²");
      const [videoUrl, setVideoUrl] = useState(null);
      const [modal, setModal] = useState(null);
      const [floorData, setFloorData] = useState(initialFloorData);
      const [fetchError, setFetchError] = useState(null);
      const [debugInfo, setDebugInfo] = useState(null);

      // Google Sheetã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—
      useEffect(() => {
        if (!SHEET_CSV_URL) return;

        // ã‚­ãƒ£ãƒƒã‚·ãƒ¥å¯¾ç­–ï¼šURLã®æœ«å°¾ã«æ™‚åˆ»ã‚’è¿½åŠ ã—ã¦ã€å¸¸ã«æœ€æ–°ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã‚ˆã†ã¨ã™ã‚‹
        const timestamp = new Date().getTime();
        const urlWithTimestamp = SHEET_CSV_URL + "&t=" + timestamp;

        Papa.parse(urlWithTimestamp, {
          download: true,
          header: true,
          complete: function (results) {
            const fetchedData = results.data;
            console.log("Fetched Data:", fetchedData);

            if (fetchedData.length === 0) return;

            // æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
            const newFloorData = JSON.parse(JSON.stringify(initialFloorData));
            const ignoredFloors = new Set(); // å®šç¾©ã«ãªã„ãƒ•ãƒ­ã‚¢åã‚’è¨˜éŒ²

            fetchedData.forEach(item => {
              if (!item.floor || !item.title) return;

              // ãƒ‡ãƒ¼ã‚¿ã®æ•´å½¢
              const floorKey = item.floor.trim(); // ä½™åˆ†ãªç©ºç™½ã‚’é™¤å»

              // ã‚³ãƒ¼ãƒ‰å´ã«å­˜åœ¨ã—ãªã„ãƒ•ãƒ­ã‚¢åï¼ˆä¾‹: "ä»•äº‹"ã®ã¾ã¾ãªã©ï¼‰ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
              if (!newFloorData[floorKey]) {
                ignoredFloors.add(floorKey);
                return;
              }

              const newSection = {
                id: item.id || Math.random().toString(36).substr(2, 9),
                title: item.title,
                description: item.description,
                location: item.location || "NEW",
                isComingSoon: item.coming_soon === "TRUE" || item.coming_soon === "true"
              };

              // typeã«å¿œã˜ãŸãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š
              if (item.type === "video") {
                newSection.videoId = item.url;
              } else if (item.type === "modal") {
                newSection.actionType = "modal";
                newSection.modalUrl = item.url;
              }

              // ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
              newFloorData[floorKey].sections.push(newSection);
            });

            setFloorData(newFloorData);
            setFetchError(null);

            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ï¼šã‚‚ã—ç„¡è¦–ã•ã‚ŒãŸãƒ•ãƒ­ã‚¢ãŒã‚ã‚Œã°ç”»é¢ã«è¡¨ç¤º
            if (ignoredFloors.size > 0) {
              const ignoredList = Array.from(ignoredFloors).join(", ");
              setDebugInfo(`ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«å«ã¾ã‚Œã‚‹ãƒ•ãƒ­ã‚¢åã€Œ${ignoredList}ã€ã¯ã€ç¾åœ¨ã®è¨­å®šï¼ˆ${Object.keys(newFloorData).join(", ")}ï¼‰ã«å­˜åœ¨ã—ãªã„ãŸã‚ç„¡è¦–ã•ã‚Œã¾ã—ãŸã€‚ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå´ã®ã€Œfloorã€åˆ—ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‹ã€åæ˜ å¾…ã¡ï¼ˆæœ€å¤§5åˆ†ï¼‰ã§ãªã„ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
            } else {
              setDebugInfo(null);
            }

            console.log("Updated floor data from Google Sheet");
          },
          error: function (err) {
            console.error("Error fetching CSV:", err);
            setFetchError("ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLãŒã€ŒWebã«å…¬é–‹ã€ã®ã‚‚ã®ã‹ç¢ºèªã—ã¦ãã ã•ã„(CORSã‚¨ãƒ©ãƒ¼ã®å¯èƒ½æ€§)ã€‚");
          }
        });
      }, []);

      useEffect(() => { lucide.createIcons(); }, [currentFloor, videoUrl, modal, floorData]);

      useEffect(() => {
        const handleEsc = (e) => {
          if (e.key === 'Escape') {
            setVideoUrl(null);
            setModal(null);
          }
        };
        window.addEventListener('keydown', handleEsc);
        return () => window.removeEventListener('keydown', handleEsc);
      }, []);

      const data = floorData[currentFloor];

      return (
        <div className="min-h-screen bg-gray-50">
          <Hero />

          {fetchError && (
            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative max-w-4xl mx-auto mt-4" role="alert">
              <strong className="font-bold">è¨­å®šã‚¨ãƒ©ãƒ¼: </strong>
              <span className="block sm:inline">{fetchError}</span>
            </div>
          )}

          {debugInfo && (
            <div className="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative max-w-4xl mx-auto mt-4" role="alert">
              <strong className="font-bold">ç¢ºèª: </strong>
              <span className="block sm:inline">{debugInfo}</span>
            </div>
          )}

          <Header
            currentFloor={currentFloor}
            setCurrentFloor={setCurrentFloor}
            meta={floorMeta[currentFloor]}
            data={data}
          />

          <FloorContent
            data={data}
            onVideoClick={setVideoUrl}
            onModalClick={setModal}
          />

          <Footer />

          {videoUrl && <VideoModal videoId={videoUrl} onClose={() => setVideoUrl(null)} />}
          {modal && <ContentModal content={modal} onClose={() => setModal(null)} />}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>

</html>